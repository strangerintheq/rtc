(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();var ne,b,Rt,F,Xe,Ot,xt,It,$e,Ie,Le,Lt,ee={},Dt=[],Sn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,se=Array.isArray;function D(t,e){for(var n in e)t[n]=e[n];return t}function We(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function j(t,e,n){var s,i,r,o={};for(r in e)r=="key"?s=e[r]:r=="ref"?i=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?ne.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(r in t.defaultProps)o[r]===void 0&&(o[r]=t.defaultProps[r]);return Y(t,o,s,i,null)}function Y(t,e,n,s,i){var r={type:t,props:e,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Rt,__i:-1,__u:0};return i==null&&b.vnode!=null&&b.vnode(r),r}function wn(){return{current:null}}function M(t){return t.children}function U(t,e){this.props=t,this.context=e}function J(t,e){if(e==null)return t.__?J(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?J(t):null}function Ut(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Ut(t)}}function De(t){(!t.__d&&(t.__d=!0)&&F.push(t)&&!de.__r++||Xe!=b.debounceRendering)&&((Xe=b.debounceRendering)||Ot)(de)}function de(){for(var t,e,n,s,i,r,o,c=1;F.length;)F.length>c&&F.sort(xt),t=F.shift(),c=F.length,t.__d&&(n=void 0,s=void 0,i=(s=(e=t).__v).__e,r=[],o=[],e.__P&&((n=D({},s)).__v=s.__v+1,b.vnode&&b.vnode(n),ze(e.__P,n,s,e.__n,e.__P.namespaceURI,32&s.__u?[i]:null,r,i??J(s),!!(32&s.__u),o),n.__v=s.__v,n.__.__k[n.__i]=n,jt(r,n,o),s.__e=s.__=null,n.__e!=i&&Ut(n)));de.__r=0}function Nt(t,e,n,s,i,r,o,c,u,a,f){var _,d,l,h,m,p,g,y=s&&s.__k||Dt,$=e.length;for(u=kn(n,e,y,u,$),_=0;_<$;_++)(l=n.__k[_])!=null&&(d=l.__i==-1?ee:y[l.__i]||ee,l.__i=_,p=ze(t,l,d,i,r,o,c,u,a,f),h=l.__e,l.ref&&d.ref!=l.ref&&(d.ref&&He(d.ref,null,l),f.push(l.ref,l.__c||h,l)),m==null&&h!=null&&(m=h),(g=!!(4&l.__u))||d.__k===l.__k?u=At(l,u,t,g):typeof l.type=="function"&&p!==void 0?u=p:h&&(u=h.nextSibling),l.__u&=-7);return n.__e=m,u}function kn(t,e,n,s,i){var r,o,c,u,a,f=n.length,_=f,d=0;for(t.__k=new Array(i),r=0;r<i;r++)(o=e[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(u=r+d,(o=t.__k[r]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Y(null,o,null,null,null):se(o)?Y(M,{children:o},null,null,null):o.constructor==null&&o.__b>0?Y(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,c=null,(a=o.__i=Tn(o,n,u,_))!=-1&&(_--,(c=n[a])&&(c.__u|=2)),c==null||c.__v==null?(a==-1&&(i>f?d--:i<f&&d++),typeof o.type!="function"&&(o.__u|=4)):a!=u&&(a==u-1?d--:a==u+1?d++:(a>u?d--:d++,o.__u|=4))):t.__k[r]=null;if(_)for(r=0;r<f;r++)(c=n[r])!=null&&(2&c.__u)==0&&(c.__e==s&&(s=J(c)),$t(c,c));return s}function At(t,e,n,s){var i,r;if(typeof t.type=="function"){for(i=t.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=t,e=At(i[r],e,n,s));return e}t.__e!=e&&(s&&(e&&t.type&&!e.parentNode&&(e=J(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function A(t,e){return e=e||[],t==null||typeof t=="boolean"||(se(t)?t.some(function(n){A(n,e)}):e.push(t)),e}function Tn(t,e,n,s){var i,r,o,c=t.key,u=t.type,a=e[n],f=a!=null&&(2&a.__u)==0;if(a===null&&t.key==null||f&&c==a.key&&u==a.type)return n;if(s>(f?1:0)){for(i=n-1,r=n+1;i>=0||r<e.length;)if((a=e[o=i>=0?i--:r++])!=null&&(2&a.__u)==0&&c==a.key&&u==a.type)return o}return-1}function Ye(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Sn.test(e)?n:n+"px"}function ae(t,e,n,s,i){var r,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)n&&e in n||Ye(t.style,e,"");if(n)for(e in n)s&&n[e]==s[e]||Ye(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(It,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+r]=n,n?s?n.u=s.u:(n.u=$e,t.addEventListener(e,r?Le:Ie,r)):t.removeEventListener(e,r?Le:Ie,r);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Ke(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=$e++;else if(e.t<n.u)return;return n(b.event?b.event(e):e)}}}function ze(t,e,n,s,i,r,o,c,u,a){var f,_,d,l,h,m,p,g,y,$,W,oe,Q,Ze,ce,Z,Ee,L=e.type;if(e.constructor!=null)return null;128&n.__u&&(u=!!(32&n.__u),r=[c=e.__e=n.__e]),(f=b.__b)&&f(e);e:if(typeof L=="function")try{if(g=e.props,y="prototype"in L&&L.prototype.render,$=(f=L.contextType)&&s[f.__c],W=f?$?$.props.value:f.__:s,n.__c?p=(_=e.__c=n.__c).__=_.__E:(y?e.__c=_=new L(g,W):(e.__c=_=new U(g,W),_.constructor=L,_.render=Cn),$&&$.sub(_),_.props=g,_.state||(_.state={}),_.context=W,_.__n=s,d=_.__d=!0,_.__h=[],_._sb=[]),y&&_.__s==null&&(_.__s=_.state),y&&L.getDerivedStateFromProps!=null&&(_.__s==_.state&&(_.__s=D({},_.__s)),D(_.__s,L.getDerivedStateFromProps(g,_.__s))),l=_.props,h=_.state,_.__v=e,d)y&&L.getDerivedStateFromProps==null&&_.componentWillMount!=null&&_.componentWillMount(),y&&_.componentDidMount!=null&&_.__h.push(_.componentDidMount);else{if(y&&L.getDerivedStateFromProps==null&&g!==l&&_.componentWillReceiveProps!=null&&_.componentWillReceiveProps(g,W),!_.__e&&_.shouldComponentUpdate!=null&&_.shouldComponentUpdate(g,_.__s,W)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(_.props=g,_.state=_.__s,_.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(q){q&&(q.__=e)}),oe=0;oe<_._sb.length;oe++)_.__h.push(_._sb[oe]);_._sb=[],_.__h.length&&o.push(_);break e}_.componentWillUpdate!=null&&_.componentWillUpdate(g,_.__s,W),y&&_.componentDidUpdate!=null&&_.__h.push(function(){_.componentDidUpdate(l,h,m)})}if(_.context=W,_.props=g,_.__P=t,_.__e=!1,Q=b.__r,Ze=0,y){for(_.state=_.__s,_.__d=!1,Q&&Q(e),f=_.render(_.props,_.state,_.context),ce=0;ce<_._sb.length;ce++)_.__h.push(_._sb[ce]);_._sb=[]}else do _.__d=!1,Q&&Q(e),f=_.render(_.props,_.state,_.context),_.state=_.__s;while(_.__d&&++Ze<25);_.state=_.__s,_.getChildContext!=null&&(s=D(D({},s),_.getChildContext())),y&&!d&&_.getSnapshotBeforeUpdate!=null&&(m=_.getSnapshotBeforeUpdate(l,h)),Z=f,f!=null&&f.type===M&&f.key==null&&(Z=Mt(f.props.children)),c=Nt(t,se(Z)?Z:[Z],e,n,s,i,r,o,c,u,a),_.base=e.__e,e.__u&=-161,_.__h.length&&o.push(_),p&&(_.__E=_.__=null)}catch(q){if(e.__v=null,u||r!=null)if(q.then){for(e.__u|=u?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;r[r.indexOf(c)]=null,e.__e=c}else{for(Ee=r.length;Ee--;)We(r[Ee]);Ue(e)}else e.__e=n.__e,e.__k=n.__k,q.then||Ue(e);b.__e(q,e,n)}else r==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):c=e.__e=En(n.__e,e,n,s,i,r,o,u,a);return(f=b.diffed)&&f(e),128&e.__u?void 0:c}function Ue(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(Ue)}function jt(t,e,n){for(var s=0;s<n.length;s++)He(n[s],n[++s],n[++s]);b.__c&&b.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(r){r.call(i)})}catch(r){b.__e(r,i.__v)}})}function Mt(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:se(t)?t.map(Mt):D({},t)}function En(t,e,n,s,i,r,o,c,u){var a,f,_,d,l,h,m,p=n.props,g=e.props,y=e.type;if(y=="svg"?i="http://www.w3.org/2000/svg":y=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),r!=null){for(a=0;a<r.length;a++)if((l=r[a])&&"setAttribute"in l==!!y&&(y?l.localName==y:l.nodeType==3)){t=l,r[a]=null;break}}if(t==null){if(y==null)return document.createTextNode(g);t=document.createElementNS(i,y,g.is&&g),c&&(b.__m&&b.__m(e,r),c=!1),r=null}if(y==null)p===g||c&&t.data==g||(t.data=g);else{if(r=r&&ne.call(t.childNodes),p=n.props||ee,!c&&r!=null)for(p={},a=0;a<t.attributes.length;a++)p[(l=t.attributes[a]).name]=l.value;for(a in p)if(l=p[a],a!="children"){if(a=="dangerouslySetInnerHTML")_=l;else if(!(a in g)){if(a=="value"&&"defaultValue"in g||a=="checked"&&"defaultChecked"in g)continue;ae(t,a,null,l,i)}}for(a in g)l=g[a],a=="children"?d=l:a=="dangerouslySetInnerHTML"?f=l:a=="value"?h=l:a=="checked"?m=l:c&&typeof l!="function"||p[a]===l||ae(t,a,l,p[a],i);if(f)c||_&&(f.__html==_.__html||f.__html==t.innerHTML)||(t.innerHTML=f.__html),e.__k=[];else if(_&&(t.innerHTML=""),Nt(e.type=="template"?t.content:t,se(d)?d:[d],e,n,s,y=="foreignObject"?"http://www.w3.org/1999/xhtml":i,r,o,r?r[0]:n.__k&&J(n,0),c,u),r!=null)for(a=r.length;a--;)We(r[a]);c||(a="value",y=="progress"&&h==null?t.removeAttribute("value"):h!=null&&(h!==t[a]||y=="progress"&&!h||y=="option"&&h!=p[a])&&ae(t,a,h,p[a],i),a="checked",m!=null&&m!=t[a]&&ae(t,a,m,p[a],i))}return t}function He(t,e,n){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&e==null||(t.__u=t(e))}else t.current=e}catch(i){b.__e(i,n)}}function $t(t,e,n){var s,i;if(b.unmount&&b.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||He(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(r){b.__e(r,e)}s.base=s.__P=null}if(s=t.__k)for(i=0;i<s.length;i++)s[i]&&$t(s[i],e,n||typeof t.type!="function");n||We(t.__e),t.__c=t.__=t.__e=void 0}function Cn(t,e,n){return this.constructor(t,n)}function te(t,e,n){var s,i,r,o;e==document&&(e=document.documentElement),b.__&&b.__(t,e),i=(s=typeof n=="function")?null:n&&n.__k||e.__k,r=[],o=[],ze(e,t=(!s&&n||e).__k=j(M,null,[t]),i||ee,ee,e.namespaceURI,!s&&n?[n]:i?null:e.firstChild?ne.call(e.childNodes):null,r,!s&&n?n:i?i.__e:e.firstChild,s,o),jt(r,t,o)}function Wt(t,e){te(t,e,Wt)}function Pn(t,e,n){var s,i,r,o,c=D({},t.props);for(r in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)r=="key"?s=e[r]:r=="ref"?i=e[r]:c[r]=e[r]===void 0&&o!=null?o[r]:e[r];return arguments.length>2&&(c.children=arguments.length>3?ne.call(arguments,2):n),Y(t.type,c,s||t.key,i||t.ref,null)}function Rn(t){function e(n){var s,i;return this.getChildContext||(s=new Set,(i={})[e.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(r){this.props.value!=r.value&&s.forEach(function(o){o.__e=!0,De(o)})},this.sub=function(r){s.add(r);var o=r.componentWillUnmount;r.componentWillUnmount=function(){s&&s.delete(r),o&&o.call(r)}}),n.children}return e.__c="__cC"+Lt++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,s){return n.children(s)}).contextType=e,e}ne=Dt.slice,b={__e:function(t,e,n,s){for(var i,r,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((r=i.constructor)&&r.getDerivedStateFromError!=null&&(i.setState(r.getDerivedStateFromError(t)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,s||{}),o=i.__d),o)return i.__E=i}catch(c){t=c}throw t}},Rt=0,U.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=D({},this.state),typeof t=="function"&&(t=t(D({},n),this.props)),t&&D(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),De(this))},U.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),De(this))},U.prototype.render=M,F=[],Ot=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,xt=function(t,e){return t.__v.__b-e.__v.__b},de.__r=0,It=/(PointerCapture)$|Capture$/i,$e=0,Ie=Ke(!1),Le=Ke(!0),Lt=0;var On=0;function R(t,e,n,s,i,r){e||(e={});var o,c,u=e;if("ref"in u)for(c in u={},e)c=="ref"?o=e[c]:u[c]=e[c];var a={type:t,props:u,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--On,__i:-1,__u:0,__source:i,__self:r};if(typeof t=="function"&&(o=t.defaultProps))for(c in o)u[c]===void 0&&(u[c]=o[c]);return b.vnode&&b.vnode(a),a}var H,w,Ce,et,V=0,zt=[],k=b,tt=k.__b,nt=k.__r,st=k.diffed,it=k.__c,rt=k.unmount,ot=k.__;function G(t,e){k.__h&&k.__h(w,t,V||e),V=0;var n=w.__H||(w.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Fe(t){return V=1,qe(Gt,t)}function qe(t,e,n){var s=G(H++,2);if(s.t=t,!s.__c&&(s.__=[n?n(e):Gt(void 0,e),function(c){var u=s.__N?s.__N[0]:s.__[0],a=s.t(u,c);u!==a&&(s.__N=[a,s.__[1]],s.__c.setState({}))}],s.__c=w,!w.__f)){var i=function(c,u,a){if(!s.__c.__H)return!0;var f=s.__c.__H.__.filter(function(d){return!!d.__c});if(f.every(function(d){return!d.__N}))return!r||r.call(this,c,u,a);var _=s.__c.props!==c;return f.forEach(function(d){if(d.__N){var l=d.__[0];d.__=d.__N,d.__N=void 0,l!==d.__[0]&&(_=!0)}}),r&&r.call(this,c,u,a)||_};w.__f=!0;var r=w.shouldComponentUpdate,o=w.componentWillUpdate;w.componentWillUpdate=function(c,u,a){if(this.__e){var f=r;r=void 0,i(c,u,a),r=f}o&&o.call(this,c,u,a)},w.shouldComponentUpdate=i}return s.__N||s.__}function Be(t,e){var n=G(H++,3);!k.__s&&Je(n.__H,e)&&(n.__=t,n.u=e,w.__H.__h.push(n))}function ie(t,e){var n=G(H++,4);!k.__s&&Je(n.__H,e)&&(n.__=t,n.u=e,w.__h.push(n))}function Ht(t){return V=5,ve(function(){return{current:t}},[])}function Ft(t,e,n){V=6,ie(function(){if(typeof t=="function"){var s=t(e());return function(){t(null),s&&typeof s=="function"&&s()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function ve(t,e){var n=G(H++,7);return Je(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function qt(t,e){return V=8,ve(function(){return t},e)}function Bt(t){var e=w.context[t.__c],n=G(H++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(w)),e.props.value):t.__}function Jt(t,e){k.useDebugValue&&k.useDebugValue(e?e(t):t)}function Vt(){var t=G(H++,11);if(!t.__){for(var e=w.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function xn(){for(var t;t=zt.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(le),t.__H.__h.forEach(Ne),t.__H.__h=[]}catch(e){t.__H.__h=[],k.__e(e,t.__v)}}k.__b=function(t){w=null,tt&&tt(t)},k.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),ot&&ot(t,e)},k.__r=function(t){nt&&nt(t),H=0;var e=(w=t.__c).__H;e&&(Ce===w?(e.__h=[],w.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(le),e.__h.forEach(Ne),e.__h=[],H=0)),Ce=w},k.diffed=function(t){st&&st(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(zt.push(e)!==1&&et===k.requestAnimationFrame||((et=k.requestAnimationFrame)||In)(xn)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Ce=w=null},k.__c=function(t,e){e.some(function(n){try{n.__h.forEach(le),n.__h=n.__h.filter(function(s){return!s.__||Ne(s)})}catch(s){e.some(function(i){i.__h&&(i.__h=[])}),e=[],k.__e(s,n.__v)}}),it&&it(t,e)},k.unmount=function(t){rt&&rt(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{le(s)}catch(i){e=i}}),n.__H=void 0,e&&k.__e(e,n.__v))};var ct=typeof requestAnimationFrame=="function";function In(t){var e,n=function(){clearTimeout(s),ct&&cancelAnimationFrame(e),setTimeout(t)},s=setTimeout(n,35);ct&&(e=requestAnimationFrame(n))}function le(t){var e=w,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),w=e}function Ne(t){var e=w;t.__c=t.__(),w=e}function Je(t,e){return!t||t.length!==e.length||e.some(function(n,s){return n!==t[s]})}function Gt(t,e){return typeof e=="function"?e(t):e}function Qt(t,e){for(var n in e)t[n]=e[n];return t}function Ae(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var s in e)if(s!=="__source"&&t[s]!==e[s])return!0;return!1}function Zt(t,e){var n=e(),s=Fe({t:{__:n,u:e}}),i=s[0].t,r=s[1];return ie(function(){i.__=n,i.u=e,Pe(i)&&r({t:i})},[t,n,e]),Be(function(){return Pe(i)&&r({t:i}),t(function(){Pe(i)&&r({t:i})})},[t]),n}function Pe(t){var e,n,s=t.u,i=t.__;try{var r=s();return!((e=i)===(n=r)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Xt(t){t()}function Yt(t){return t}function Kt(){return[!1,Xt]}var en=ie;function je(t,e){this.props=t,this.context=e}function re(t,e){function n(i){var r=this.props.ref,o=r==i.ref;return!o&&r&&(r.call?r(null):r.current=null),e?!e(this.props,i)||!o:Ae(this.props,i)}function s(i){return this.shouldComponentUpdate=n,j(t,i)}return s.displayName="Memo("+(t.displayName||t.name)+")",s.prototype.isReactComponent=!0,s.__f=!0,s.type=t,s}(je.prototype=new U).isPureReactComponent=!0,je.prototype.shouldComponentUpdate=function(t,e){return Ae(this.props,t)||Ae(this.state,e)};var at=b.__b;b.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),at&&at(t)};var Ln=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Dn(t){function e(n){var s=Qt({},n);return delete s.ref,t(s,n.ref||null)}return e.$$typeof=Ln,e.render=t,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var ut=function(t,e){return t==null?null:A(A(t).map(e))},Un={map:ut,forEach:ut,count:function(t){return t?A(t).length:0},only:function(t){var e=A(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:A},Nn=b.__e;b.__e=function(t,e,n,s){if(t.then){for(var i,r=e;r=r.__;)if((i=r.__c)&&i.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),i.__c(t,e)}Nn(t,e,n,s)};var lt=b.unmount;function tn(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(s){typeof s.__c=="function"&&s.__c()}),t.__c.__H=null),(t=Qt({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(s){return tn(s,e,n)})),t}function nn(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(s){return nn(s,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function _e(){this.__u=0,this.o=null,this.__b=null}function sn(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function An(t){var e,n,s;function i(r){if(e||(e=t()).then(function(o){n=o.default||o},function(o){s=o}),s)throw s;if(!n)throw e;return j(n,r)}return i.displayName="Lazy",i.__f=!0,i}function X(){this.i=null,this.l=null}b.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),lt&&lt(t)},(_e.prototype=new U).__c=function(t,e){var n=e.__c,s=this;s.o==null&&(s.o=[]),s.o.push(n);var i=sn(s.__v),r=!1,o=function(){r||(r=!0,n.__R=null,i?i(c):c())};n.__R=o;var c=function(){if(!--s.__u){if(s.state.__a){var u=s.state.__a;s.__v.__k[0]=nn(u,u.__c.__P,u.__c.__O)}var a;for(s.setState({__a:s.__b=null});a=s.o.pop();)a.forceUpdate()}};s.__u++||32&e.__u||s.setState({__a:s.__b=s.__v.__k[0]}),t.then(o,o)},_e.prototype.componentWillUnmount=function(){this.o=[]},_e.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),s=this.__v.__k[0].__c;this.__v.__k[0]=tn(this.__b,n,s.__O=s.__P)}this.__b=null}var i=e.__a&&j(M,null,t.fallback);return i&&(i.__u&=-33),[j(M,null,e.__a?null:t.children),i]};var _t=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function jn(t){return this.getChildContext=function(){return t.context},t.children}function Mn(t){var e=this,n=t.h;if(e.componentWillUnmount=function(){te(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),!e.v){for(var s=e.__v;s!==null&&!s.__m&&s.__!==null;)s=s.__;e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:s.__m},contains:function(){return!0},insertBefore:function(i,r){this.childNodes.push(i),e.h.insertBefore(i,r)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),e.h.removeChild(i)}}}te(j(jn,{context:e.context},t.__v),e.v)}function $n(t,e){var n=j(Mn,{__v:t,h:e});return n.containerInfo=e,n}(X.prototype=new U).__a=function(t){var e=this,n=sn(e.__v),s=e.l.get(t);return s[0]++,function(i){var r=function(){e.props.revealOrder?(s.push(i),_t(e,t,s)):i()};n?n(r):r()}},X.prototype.render=function(t){this.i=null,this.l=new Map;var e=A(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},X.prototype.componentDidUpdate=X.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){_t(t,n,e)})};var rn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Wn=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,zn=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Hn=/[A-Z0-9]/g,Fn=typeof document<"u",qn=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function on(t,e,n){return e.__k==null&&(e.textContent=""),te(t,e),typeof n=="function"&&n(),t?t.__c:null}function Bn(t,e,n){return Wt(t,e),typeof n=="function"&&n(),t?t.__c:null}U.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(U.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var ht=b.event;function Jn(){}function Vn(){return this.cancelBubble}function Gn(){return this.defaultPrevented}b.event=function(t){return ht&&(t=ht(t)),t.persist=Jn,t.isPropagationStopped=Vn,t.isDefaultPrevented=Gn,t.nativeEvent=t};var Ve,Qn={enumerable:!1,configurable:!0,get:function(){return this.class}},ft=b.vnode;b.vnode=function(t){typeof t.type=="string"&&(function(e){var n=e.props,s=e.type,i={},r=s.indexOf("-")===-1;for(var o in n){var c=n[o];if(!(o==="value"&&"defaultValue"in n&&c==null||Fn&&o==="children"&&s==="noscript"||o==="class"||o==="className")){var u=o.toLowerCase();o==="defaultValue"&&"value"in n&&n.value==null?o="value":o==="download"&&c===!0?c="":u==="translate"&&c==="no"?c=!1:u[0]==="o"&&u[1]==="n"?u==="ondoubleclick"?o="ondblclick":u!=="onchange"||s!=="input"&&s!=="textarea"||qn(n.type)?u==="onfocus"?o="onfocusin":u==="onblur"?o="onfocusout":zn.test(o)&&(o=u):u=o="oninput":r&&Wn.test(o)?o=o.replace(Hn,"-$&").toLowerCase():c===null&&(c=void 0),u==="oninput"&&i[o=u]&&(o="oninputCapture"),i[o]=c}}s=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=A(n.children).forEach(function(a){a.props.selected=i.value.indexOf(a.props.value)!=-1})),s=="select"&&i.defaultValue!=null&&(i.value=A(n.children).forEach(function(a){a.props.selected=i.multiple?i.defaultValue.indexOf(a.props.value)!=-1:i.defaultValue==a.props.value})),n.class&&!n.className?(i.class=n.class,Object.defineProperty(i,"className",Qn)):(n.className&&!n.class||n.class&&n.className)&&(i.class=i.className=n.className),e.props=i})(t),t.$$typeof=rn,ft&&ft(t)};var dt=b.__r;b.__r=function(t){dt&&dt(t),Ve=t.__c};var pt=b.diffed;b.diffed=function(t){pt&&pt(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),Ve=null};var Zn={ReactCurrentDispatcher:{current:{readContext:function(t){return Ve.__n[t.__c].props.value},useCallback:qt,useContext:Bt,useDebugValue:Jt,useDeferredValue:Yt,useEffect:Be,useId:Vt,useImperativeHandle:Ft,useInsertionEffect:en,useLayoutEffect:ie,useMemo:ve,useReducer:qe,useRef:Ht,useState:Fe,useSyncExternalStore:Zt,useTransition:Kt}}};function Xn(t){return j.bind(null,t)}function ye(t){return!!t&&t.$$typeof===rn}function Yn(t){return ye(t)&&t.type===M}function Kn(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function es(t){return ye(t)?Pn.apply(null,arguments):t}function cn(t){return!!t.__k&&(te(null,t),!0)}function ts(t){return t&&(t.base||t.nodeType===1&&t)||null}var ns=function(t,e){return t(e)},ss=function(t,e){return t(e)},is=M,rs=ye,ue={useState:Fe,useId:Vt,useReducer:qe,useEffect:Be,useLayoutEffect:ie,useInsertionEffect:en,useTransition:Kt,useDeferredValue:Yt,useSyncExternalStore:Zt,startTransition:Xt,useRef:Ht,useImperativeHandle:Ft,useMemo:ve,useCallback:qt,useContext:Bt,useDebugValue:Jt,version:"18.3.1",Children:Un,render:on,hydrate:Bn,unmountComponentAtNode:cn,createPortal:$n,createElement:j,createContext:Rn,createFactory:Xn,cloneElement:es,createRef:wn,Fragment:M,isValidElement:ye,isElement:rs,isFragment:Yn,isMemo:Kn,findDOMNode:ts,Component:U,PureComponent:je,memo:re,forwardRef:Dn,flushSync:ss,unstable_batchedUpdates:ns,StrictMode:is,Suspense:_e,SuspenseList:X,lazy:An,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Zn};const mt=t=>{let e;const n=new Set,s=(a,f)=>{const _=typeof a=="function"?a(e):a;if(!Object.is(_,e)){const d=e;e=f??(typeof _!="object"||_===null)?_:Object.assign({},e,_),n.forEach(l=>l(e,d))}},i=()=>e,c={setState:s,getState:i,getInitialState:()=>u,subscribe:a=>(n.add(a),()=>n.delete(a))},u=e=t(s,i,c);return c},os=t=>t?mt(t):mt,cs=t=>t;function as(t,e=cs){const n=ue.useSyncExternalStore(t.subscribe,ue.useCallback(()=>e(t.getState()),[t,e]),ue.useCallback(()=>e(t.getInitialState()),[t,e]));return ue.useDebugValue(n),n}const bt=t=>{const e=os(t),n=s=>as(e,s);return Object.assign(n,e),n},an=t=>t?bt(t):bt;var P=(t=>(t.desktopStreamTrack="desktopStreamTrack",t.cameraStreamTrack="cameraStreamTrack",t.microphoneStreamTrack="microphoneStreamTrack",t))(P||{}),I=(t=>(t.HIGH="HIGH",t.MEDIUM="MEDIUM",t.LOW="LOW",t))(I||{});const us={[I.HIGH]:30,[I.MEDIUM]:20,[I.LOW]:10},gt=t=>({facingMode:"user",frameRate:{max:us[t]}}),vt=t=>!0,ls={[I.HIGH]:1024,[I.MEDIUM]:512,[I.LOW]:256},_s={[I.HIGH]:30,[I.MEDIUM]:20,[I.LOW]:10},yt=t=>({facingMode:"user",width:{ideal:ls[t]},frameRate:{max:_s[t]}}),Se=an((t,e)=>{let n;async function s(o,c){o&&await o.applyConstraints(c)}function i(...o){const c={};o.forEach(u=>{const a=e()[u];a&&(a.stop(),c[u]=null,n.setEnabled(u,!1))}),t(c)}function r(o,c){t({[c]:o}),n.setEnabled(c,!!o)}return{quality:I.LOW,async setQuality(o){const{cameraStreamTrack:c,desktopStreamTrack:u,microphoneStreamTrack:a}=e();await s(c,yt(o)),await s(u,gt(o)),await s(a,vt()),t({quality:o}),n?.setQuality(o)},async startCameraStream(){try{const o=await navigator.mediaDevices.getUserMedia({audio:!1,video:yt(e().quality)});r(o.getTracks()[0],P.cameraStreamTrack)}catch{n.setEnabled(P.cameraStreamTrack,!1)}},async stopCameraStream(){i(P.cameraStreamTrack)},async startDesktopStream(){try{const o=await navigator.mediaDevices.getDisplayMedia({audio:!1,video:gt(e().quality)});r(o.getTracks()[0],P.desktopStreamTrack)}catch{n.setEnabled(P.desktopStreamTrack,!1)}},async stopDesktopStream(){i(P.desktopStreamTrack)},async startMicrophoneStream(){try{const o=await navigator.mediaDevices.getUserMedia({video:!1,audio:vt(e().quality)});r(o.getTracks()[0],P.microphoneStreamTrack)}catch{n.setEnabled(P.microphoneStreamTrack,!1)}},async stopMicrophoneStream(){i(P.microphoneStreamTrack)},stop(){i(P.cameraStreamTrack,P.microphoneStreamTrack,P.microphoneStreamTrack)},getActualTracks(o){const c=[],{desktopStreamTrack:u,cameraStreamTrack:a,microphoneStreamTrack:f}=e();return u?c.push(u):a&&c.push(a),!o&&f&&c.push(f),c},async restore(o){n=o,t({quality:o.getQuality()}),n.isEnabled(P.cameraStreamTrack)&&await e().startCameraStream(),n.isEnabled(P.microphoneStreamTrack)&&await e().startMicrophoneStream(),n.isEnabled(P.desktopStreamTrack)&&await e().startDesktopStream()}}});function we(t){const e=t?.prefix,n=e&&t?.color;return(...s)=>{n&&s.unshift("background-color: "+n),e&&s.unshift((n?"%c":"")+e),console.log(...s)}}const hs=we({prefix:"[createConnection]",color:"#ded"});function fs(t,e){const n={iceRestart:!0,offerToReceiveAudio:!0,offerToReceiveVideo:!0},s=new RTCPeerConnection(window.cfg);return s.oniceconnectionstatechange=()=>{s.iceConnectionState==="failed"&&s.restartIce()},{innerState:{peerConnection:s,localUserId:t,remoteUserId:e},async createOffer(){const r=await s.createOffer(n);return await s.setLocalDescription(new RTCSessionDescription(r)),s.localDescription},async receiveOffer(r){await s.setRemoteDescription(r);const o=await s.createAnswer(n);return await s.setLocalDescription(new RTCSessionDescription(o)),s.localDescription},async receiveAnswer(r){await s.setRemoteDescription(r)},async disconnect(){await s.close()},async iceCandidate(r){hs("processing ice candidate"),await s.addIceCandidate(r)},updateTracks(r){r.forEach(o=>s.addTrack(o))}}}function ds(t,e){return St(t)<St(e)}function St(t){let e,n=new Uint32Array([1,2,3,4].map(s=>parseInt(t.substr(s*8,8),16)));return e=n[3],n[3]=n[2],n[2]=n[1],n[1]=n[0],e^=e<<11,e^=e>>>8,n[0]=e^n[0]^n[0]>>>19,n[0]/4294967296}function ps(t){return{userId:t,tracks:[],progress:0,iceCandidates:[],status:""}}const Me=we({prefix:"[processIceCandidate]",color:"#edd"});async function ms(t,e){Me("received ice candidate"),t.connection&&t.connection.innerState.peerConnection.remoteDescription?await t.connection.iceCandidate(e):(Me("queuing ice candidate"),t.iceCandidates.push(e))}function wt(t){t.iceCandidates.length&&(Me("processing ice candidates queue"),t.iceCandidates.forEach(t.connection.iceCandidate),t.iceCandidates.splice(0,t.iceCandidates.length))}const x=we({prefix:"[createConference]",color:"#dde"});function bs(){const t={currentUserId:null,signalling:null,otherUsers:[]};function e(l,h){return{from:t.currentUserId,to:l.userId,payload:h}}function n(l){return h=>{const m=t.otherUsers.find(p=>p.userId===h.from);m&&l(m,h.payload)}}async function s(l){const h=l.filter(m=>m!==t.currentUserId);await _(r(h)),await f(i(h))}function i(l){return t.otherUsers.filter(h=>!l.includes(h.userId))}function r(l){const h=t.otherUsers.map(m=>m.userId);return l.filter(m=>!h.includes(m)).map(ps)}async function o(l){const h=await l.connection.createOffer();x("send offer to:",l.userId),await t.signalling.offer.emit(e(l,h))}async function c(l,h){x("received OFFER from:",l.userId),await d(l);const m=await l.connection.receiveOffer(h);x("send ANSWER to:",l.userId),await t.signalling.answer.emit(e(l,m)),wt(l)}async function u(l,h){x("received ANSWER from:",l.userId),await l.connection.receiveAnswer(h),wt(l)}const a={onChange:null,onJoin:null,onLeft:null,async connect(l,h){x("connect, currentUserId:",l),t.currentUserId=l,t.signalling=h,h.setUserIdList=s,h.offer.on(n(c)),h.answer.on(n(u)),h.iceCandidate.on(n(ms)),await h.connect()},async disconnect(){await t.signalling.off(),await f(t.otherUsers)},updateTracks(l){x("updateTracks:",l),t.otherUsers.forEach(h=>h.connection.updateTracks(l))}};async function f(l){for(const h of l)x("user left:",h.userId),await h.connection.disconnect(),t.otherUsers.splice(t.otherUsers.indexOf(h),1);l.length&&await a.onLeft(l)}async function _(l){for(const h of l)x("user joined:",h.userId),t.otherUsers.push(h),ds(t.currentUserId,h.userId)&&(await d(h),await o(h));l.length&&await a.onJoin(l)}async function d(l,h){if(l.connection)return;x(`createConnection 
src:`,t.currentUserId,`
dst:`,l.userId),l.connection=fs(t.currentUserId,l.userId);const m=Se.getState().getActualTracks();x("setupTracks",m),l.connection.updateTracks(m);const p=l.connection.innerState.peerConnection;p.onicecandidate=async g=>{x("sending ice candidate"),await t.signalling.iceCandidate.emit(e(l,g.candidate))},p.onconnectionstatechange=g=>{x("connection state with:",l.userId,`
`,p.connectionState),l.status=p.connectionState,p.connectionState==="connected"&&!p.onnegotiationneeded&&(p.onnegotiationneeded=async y=>{x("negotiation needed with:",l.userId),await o(l)}),a.onChange([l])},p.ontrack=g=>{x("tracks changed:",l.userId,g),l.tracks.push(g.track),a.onChange([l])}}return a}class Re{}const T={socket:null,socketId:null,connected:!1,taskQueue:[],listeners:new Map,emitters:new Map};function gs(t,e){return Object.entries(t).forEach(n=>{n[1].eventName=n[0],n[1].transform=e}),t}function vs(...t){}function O(t,e,n,s){function i(r){return r instanceof n?r:new n(function(o){o(r)})}return new(n||(n=Promise))(function(r,o){function c(f){try{a(s.next(f))}catch(_){o(_)}}function u(f){try{a(s.throw(f))}catch(_){o(_)}}function a(f){f.done?r(f.value):i(f.value).then(c,u)}a((s=s.apply(t,[])).next())})}function ys(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ge={exports:{}},B=typeof Reflect=="object"?Reflect:null,kt=B&&typeof B.apply=="function"?B.apply:function(e,n,s){return Function.prototype.apply.call(e,n,s)},he;B&&typeof B.ownKeys=="function"?he=B.ownKeys:Object.getOwnPropertySymbols?he=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:he=function(e){return Object.getOwnPropertyNames(e)};function Ss(t){console&&console.warn&&console.warn(t)}var un=Number.isNaN||function(e){return e!==e};function v(){v.init.call(this)}Ge.exports=v;Ge.exports.once=Es;v.EventEmitter=v;v.prototype._events=void 0;v.prototype._eventsCount=0;v.prototype._maxListeners=void 0;var Tt=10;function ke(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(v,"defaultMaxListeners",{enumerable:!0,get:function(){return Tt},set:function(t){if(typeof t!="number"||t<0||un(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Tt=t}});v.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};v.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||un(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ln(t){return t._maxListeners===void 0?v.defaultMaxListeners:t._maxListeners}v.prototype.getMaxListeners=function(){return ln(this)};v.prototype.emit=function(e){for(var n=[],s=1;s<arguments.length;s++)n.push(arguments[s]);var i=e==="error",r=this._events;if(r!==void 0)i=i&&r.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var u=r[e];if(u===void 0)return!1;if(typeof u=="function")kt(u,this,n);else for(var a=u.length,f=pn(u,a),s=0;s<a;++s)kt(f[s],this,n);return!0};function _n(t,e,n,s){var i,r,o;if(ke(n),r=t._events,r===void 0?(r=t._events=Object.create(null),t._eventsCount=0):(r.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events),o=r[e]),o===void 0)o=r[e]=n,++t._eventsCount;else if(typeof o=="function"?o=r[e]=s?[n,o]:[o,n]:s?o.unshift(n):o.push(n),i=ln(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,Ss(c)}return t}v.prototype.addListener=function(e,n){return _n(this,e,n,!1)};v.prototype.on=v.prototype.addListener;v.prototype.prependListener=function(e,n){return _n(this,e,n,!0)};function ws(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function hn(t,e,n){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=ws.bind(s);return i.listener=n,s.wrapFn=i,i}v.prototype.once=function(e,n){return ke(n),this.on(e,hn(this,e,n)),this};v.prototype.prependOnceListener=function(e,n){return ke(n),this.prependListener(e,hn(this,e,n)),this};v.prototype.removeListener=function(e,n){var s,i,r,o,c;if(ke(n),i=this._events,i===void 0)return this;if(s=i[e],s===void 0)return this;if(s===n||s.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||n));else if(typeof s!="function"){for(r=-1,o=s.length-1;o>=0;o--)if(s[o]===n||s[o].listener===n){c=s[o].listener,r=o;break}if(r<0)return this;r===0?s.shift():ks(s,r),s.length===1&&(i[e]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",e,c||n)}return this};v.prototype.off=v.prototype.removeListener;v.prototype.removeAllListeners=function(e){var n,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var r=Object.keys(s),o;for(i=0;i<r.length;++i)o=r[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=s[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function fn(t,e,n){var s=t._events;if(s===void 0)return[];var i=s[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?Ts(i):pn(i,i.length)}v.prototype.listeners=function(e){return fn(this,e,!0)};v.prototype.rawListeners=function(e){return fn(this,e,!1)};v.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):dn.call(t,e)};v.prototype.listenerCount=dn;function dn(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}v.prototype.eventNames=function(){return this._eventsCount>0?he(this._events):[]};function pn(t,e){for(var n=new Array(e),s=0;s<e;++s)n[s]=t[s];return n}function ks(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Ts(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Es(t,e){return new Promise(function(n,s){function i(o){t.removeListener(e,r),s(o)}function r(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}mn(t,e,r,{once:!0}),e!=="error"&&Cs(t,i,{once:!0})})}function Cs(t,e,n){typeof t.on=="function"&&mn(t,"error",e,n)}function mn(t,e,n,s){if(typeof t.on=="function")s.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(r){s.once&&t.removeEventListener(e,i),n(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Ps=Ge.exports,bn=ys(Ps),S;(function(t){t[t.timeout=1]="timeout",t[t.transportClosed=2]="transportClosed",t[t.clientDisconnected=3]="clientDisconnected",t[t.clientClosed=4]="clientClosed",t[t.clientConnectToken=5]="clientConnectToken",t[t.clientRefreshToken=6]="clientRefreshToken",t[t.subscriptionUnsubscribed=7]="subscriptionUnsubscribed",t[t.subscriptionSubscribeToken=8]="subscriptionSubscribeToken",t[t.subscriptionRefreshToken=9]="subscriptionRefreshToken",t[t.transportWriteError=10]="transportWriteError",t[t.connectionClosed=11]="connectionClosed",t[t.badConfiguration=12]="badConfiguration"})(S||(S={}));var z;(function(t){t[t.connectCalled=0]="connectCalled",t[t.transportClosed=1]="transportClosed",t[t.noPing=2]="noPing",t[t.subscribeTimeout=3]="subscribeTimeout",t[t.unsubscribeError=4]="unsubscribeError"})(z||(z={}));var K;(function(t){t[t.disconnectCalled=0]="disconnectCalled",t[t.unauthorized=1]="unauthorized",t[t.badProtocol=2]="badProtocol",t[t.messageSizeLimit=3]="messageSizeLimit"})(K||(K={}));var pe;(function(t){t[t.subscribeCalled=0]="subscribeCalled",t[t.transportClosed=1]="transportClosed"})(pe||(pe={}));var me;(function(t){t[t.unsubscribeCalled=0]="unsubscribeCalled",t[t.unauthorized=1]="unauthorized",t[t.clientClosed=2]="clientClosed"})(me||(me={}));var E;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected"})(E||(E={}));var C;(function(t){t.Unsubscribed="unsubscribed",t.Subscribing="subscribing",t.Subscribed="subscribed"})(C||(C={}));function Rs(t,e){return t.lastIndexOf(e,0)===0}function gn(t){return t==null?!1:typeof t=="function"}function Os(t,e){if(globalThis.console){const n=globalThis.console[t];gn(n)&&n.apply(globalThis.console,e)}}function xs(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function be(t,e,n){t>31&&(t=31);const s=xs(0,Math.min(n,e*Math.pow(2,t)));return Math.min(n,e+s)}function Is(t){return"error"in t&&t.error!==null}function ge(t){return Math.min(t*1e3,2147483647)}class Ls extends bn{constructor(e,n,s){super(),this._resubscribeTimeout=null,this._refreshTimeout=null,this.channel=n,this.state=C.Unsubscribed,this._centrifuge=e,this._token="",this._getToken=null,this._data=null,this._getData=null,this._recover=!1,this._offset=null,this._epoch=null,this._recoverable=!1,this._positioned=!1,this._joinLeave=!1,this._minResubscribeDelay=500,this._maxResubscribeDelay=2e4,this._resubscribeTimeout=null,this._resubscribeAttempts=0,this._promises={},this._promiseId=0,this._inflight=!1,this._refreshTimeout=null,this._delta="",this._delta_negotiated=!1,this._prevValue=null,this._unsubPromise=Promise.resolve(),this._setOptions(s),this._centrifuge._debugEnabled?(this.on("state",i=>{this._debug("subscription state",n,i.oldState,"->",i.newState)}),this.on("error",i=>{this._debug("subscription error",n,i)})):this.on("error",function(){Function.prototype()})}ready(e){return this.state===C.Unsubscribed?Promise.reject({code:S.subscriptionUnsubscribed,message:this.state}):this.state===C.Subscribed?Promise.resolve():new Promise((n,s)=>{const i={resolve:n,reject:s};e&&(i.timeout=setTimeout(function(){s({code:S.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=i})}subscribe(){this._isSubscribed()||(this._resubscribeAttempts=0,this._setSubscribing(pe.subscribeCalled,"subscribe called"))}unsubscribe(){this._unsubPromise=this._setUnsubscribed(me.unsubscribeCalled,"unsubscribe called",!0)}publish(e){return O(this,void 0,void 0,function*(){return yield this._methodCall(),this._centrifuge.publish(this.channel,e)})}presence(){return O(this,void 0,void 0,function*(){return yield this._methodCall(),this._centrifuge.presence(this.channel)})}presenceStats(){return O(this,void 0,void 0,function*(){return yield this._methodCall(),this._centrifuge.presenceStats(this.channel)})}history(e){return O(this,void 0,void 0,function*(){return yield this._methodCall(),this._centrifuge.history(this.channel,e)})}_methodCall(){return this._isSubscribed()?Promise.resolve():this._isUnsubscribed()?Promise.reject({code:S.subscriptionUnsubscribed,message:this.state}):new Promise((e,n)=>{const s=this._centrifuge._config.timeout,i=setTimeout(()=>{n({code:S.timeout,message:"timeout"})},s);this._promises[this._nextPromiseId()]={timeout:i,resolve:e,reject:n}})}_nextPromiseId(){return++this._promiseId}_needRecover(){return this._recover===!0}_isUnsubscribed(){return this.state===C.Unsubscribed}_isSubscribing(){return this.state===C.Subscribing}_isSubscribed(){return this.state===C.Subscribed}_setState(e){if(this.state!==e){const n=this.state;return this.state=e,this.emit("state",{newState:e,oldState:n,channel:this.channel}),!0}return!1}_usesToken(){return this._token!==""||this._getToken!==null}_clearSubscribingState(){this._resubscribeAttempts=0,this._clearResubscribeTimeout()}_clearSubscribedState(){this._clearRefreshTimeout()}_setSubscribed(e){if(!this._isSubscribing())return;this._clearSubscribingState(),e.recoverable&&(this._recover=!0,this._offset=e.offset||0,this._epoch=e.epoch||""),e.delta?this._delta_negotiated=!0:this._delta_negotiated=!1,this._setState(C.Subscribed);const n=this._centrifuge._getSubscribeContext(this.channel,e);this.emit("subscribed",n),this._resolvePromises();const s=e.publications;if(s&&s.length>0)for(const i in s)s.hasOwnProperty(i)&&this._handlePublication(s[i]);e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),ge(e.ttl)))}_setSubscribing(e,n){return O(this,void 0,void 0,function*(){this._isSubscribing()||(this._isSubscribed()&&this._clearSubscribedState(),this._setState(C.Subscribing)&&this.emit("subscribing",{channel:this.channel,code:e,reason:n}),this._centrifuge._transport&&this._centrifuge._transport.emulation()&&(yield this._unsubPromise),this._isSubscribing()&&this._subscribe())})}_subscribe(){return this._debug("subscribing on",this.channel),this._isTransportOpen()?this._inflight?null:(this._inflight=!0,this._canSubscribeWithoutGettingToken()?this._subscribeWithoutToken():(this._getSubscriptionToken().then(e=>this._handleTokenResponse(e)).catch(e=>this._handleTokenError(e)),null)):(this._debug("delay subscribe on",this.channel,"till connected"),null)}_isTransportOpen(){return this._centrifuge._transportIsOpen}_canSubscribeWithoutGettingToken(){return!this._usesToken()||!!this._token}_subscribeWithoutToken(){return this._getData?(this._getDataAndSubscribe(this._token),null):this._sendSubscribe(this._token)}_getDataAndSubscribe(e){if(!this._getData){this._inflight=!1;return}this._getData({channel:this.channel}).then(n=>{if(!this._isSubscribing()){this._inflight=!1;return}this._data=n,this._sendSubscribe(e)}).catch(n=>this._handleGetDataError(n))}_handleGetDataError(e){if(!this._isSubscribing()){this._inflight=!1;return}if(e instanceof N){this._inflight=!1,this._failUnauthorized();return}this.emit("error",{type:"subscribeData",channel:this.channel,error:{code:S.badConfiguration,message:e?.toString()||""}}),this._inflight=!1,this._scheduleResubscribe()}_handleTokenResponse(e){if(!this._isSubscribing()){this._inflight=!1;return}if(!e){this._inflight=!1,this._failUnauthorized();return}this._token=e,this._getData?this._getDataAndSubscribe(e):this._sendSubscribe(e)}_handleTokenError(e){if(!this._isSubscribing()){this._inflight=!1;return}if(e instanceof N){this._inflight=!1,this._failUnauthorized();return}this.emit("error",{type:"subscribeToken",channel:this.channel,error:{code:S.subscriptionSubscribeToken,message:e?.toString()||""}}),this._inflight=!1,this._scheduleResubscribe()}_sendSubscribe(e){if(!this._isTransportOpen())return this._inflight=!1,null;const n=this._buildSubscribeCommand(e);return this._centrifuge._call(n).then(s=>{this._inflight=!1;const i=s.reply.subscribe;this._handleSubscribeResponse(i),s.next&&s.next()},s=>{this._inflight=!1,this._handleSubscribeError(s.error),s.next&&s.next()}),n}_buildSubscribeCommand(e){const n={channel:this.channel};if(e&&(n.token=e),this._data&&(n.data=this._data),this._positioned&&(n.positioned=!0),this._recoverable&&(n.recoverable=!0),this._joinLeave&&(n.join_leave=!0),this._needRecover()){n.recover=!0;const s=this._getOffset();s&&(n.offset=s);const i=this._getEpoch();i&&(n.epoch=i)}return this._delta&&(n.delta=this._delta),{subscribe:n}}_debug(...e){this._centrifuge._debug(...e)}_handleSubscribeError(e){if(this._isSubscribing()){if(e.code===S.timeout){this._centrifuge._disconnect(z.subscribeTimeout,"subscribe timeout",!0);return}this._subscribeError(e)}}_handleSubscribeResponse(e){this._isSubscribing()&&this._setSubscribed(e)}_setUnsubscribed(e,n,s){if(this._isUnsubscribed())return Promise.resolve();let i=Promise.resolve();return this._isSubscribed()?(s&&(i=this._centrifuge._unsubscribe(this)),this._clearSubscribedState()):this._isSubscribing()&&(this._inflight&&s&&(i=this._centrifuge._unsubscribe(this)),this._clearSubscribingState()),this._inflight=!1,this._setState(C.Unsubscribed)&&this.emit("unsubscribed",{channel:this.channel,code:e,reason:n}),this._rejectPromises({code:S.subscriptionUnsubscribed,message:this.state}),i}_handlePublication(e){if(this._delta&&this._delta_negotiated){const{newData:s,newPrevValue:i}=this._centrifuge._codec.applyDeltaIfNeeded(e,this._prevValue);e.data=s,this._prevValue=i}const n=this._centrifuge._getPublicationContext(this.channel,e);this.emit("publication",n),e.offset&&(this._offset=e.offset)}_handleJoin(e){const n=this._centrifuge._getJoinLeaveContext(e.info);this.emit("join",{channel:this.channel,info:n})}_handleLeave(e){const n=this._centrifuge._getJoinLeaveContext(e.info);this.emit("leave",{channel:this.channel,info:n})}_resolvePromises(){for(const e in this._promises)this._promises.hasOwnProperty(e)&&(this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e])}_rejectPromises(e){for(const n in this._promises)this._promises.hasOwnProperty(n)&&(this._promises[n].timeout&&clearTimeout(this._promises[n].timeout),this._promises[n].reject(e),delete this._promises[n])}_scheduleResubscribe(){if(!this._isSubscribing()){this._debug("not in subscribing state, skip resubscribe scheduling",this.channel);return}const e=this,n=this._getResubscribeDelay();this._resubscribeTimeout=setTimeout(function(){e._isSubscribing()&&e._subscribe()},n),this._debug("resubscribe scheduled after "+n,this.channel)}_subscribeError(e){if(this._isSubscribing())if(e.code<100||e.code===109||e.temporary===!0){e.code===109&&(this._token="");const n={channel:this.channel,type:"subscribe",error:e};this._centrifuge.state===E.Connected&&this.emit("error",n),this._scheduleResubscribe()}else this._setUnsubscribed(e.code,e.message,!1)}_getResubscribeDelay(){const e=be(this._resubscribeAttempts,this._minResubscribeDelay,this._maxResubscribeDelay);return this._resubscribeAttempts++,e}_setOptions(e){if(e&&(e.since&&(this._offset=e.since.offset||0,this._epoch=e.since.epoch||"",this._recover=!0),e.data&&(this._data=e.data),e.getData&&(this._getData=e.getData),e.minResubscribeDelay!==void 0&&(this._minResubscribeDelay=e.minResubscribeDelay),e.maxResubscribeDelay!==void 0&&(this._maxResubscribeDelay=e.maxResubscribeDelay),e.token&&(this._token=e.token),e.getToken&&(this._getToken=e.getToken),e.positioned===!0&&(this._positioned=!0),e.recoverable===!0&&(this._recoverable=!0),e.joinLeave===!0&&(this._joinLeave=!0),e.delta)){if(e.delta!=="fossil")throw new Error("unsupported delta format");this._delta=e.delta}}_getOffset(){const e=this._offset;return e!==null?e:0}_getEpoch(){const e=this._epoch;return e!==null?e:""}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearResubscribeTimeout(){this._resubscribeTimeout!==null&&(clearTimeout(this._resubscribeTimeout),this._resubscribeTimeout=null)}_getSubscriptionToken(){this._debug("get subscription token for channel",this.channel);const e={channel:this.channel},n=this._getToken;return n===null?(this.emit("error",{type:"configuration",channel:this.channel,error:{code:S.badConfiguration,message:"provide a function to get channel subscription token"}}),Promise.reject(new N(""))):n(e)}_refresh(){this._clearRefreshTimeout();const e=this;this._getSubscriptionToken().then(function(n){if(!e._isSubscribed())return;if(!n){e._failUnauthorized();return}e._token=n;const i={sub_refresh:{channel:e.channel,token:n}};e._centrifuge._call(i).then(r=>{const o=r.reply.sub_refresh;e._refreshResponse(o),r.next&&r.next()},r=>{e._refreshError(r.error),r.next&&r.next()})}).catch(function(n){if(n instanceof N){e._failUnauthorized();return}e.emit("error",{type:"refreshToken",channel:e.channel,error:{code:S.subscriptionRefreshToken,message:n!==void 0?n.toString():""}}),e._refreshTimeout=setTimeout(()=>e._refresh(),e._getRefreshRetryDelay())})}_refreshResponse(e){this._isSubscribed()&&(this._debug("subscription token refreshed, channel",this.channel),this._clearRefreshTimeout(),e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),ge(e.ttl))))}_refreshError(e){this._isSubscribed()&&(e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",channel:this.channel,error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._setUnsubscribed(e.code,e.message,!0))}_getRefreshRetryDelay(){return be(0,1e4,2e4)}_failUnauthorized(){this._setUnsubscribed(me.unauthorized,"unauthorized",!0)}}class Ds{constructor(e,n){this.endpoint=e,this.options=n,this._transport=null}name(){return"sockjs"}subName(){return"sockjs-"+this._transport.transport}emulation(){return!1}supported(){return this.options.sockjs!==null}initialize(e,n){this._transport=new this.options.sockjs(this.endpoint,null,this.options.sockjsOptions),this._transport.onopen=()=>{n.onOpen()},this._transport.onerror=s=>{n.onError(s)},this._transport.onclose=s=>{n.onClose(s)},this._transport.onmessage=s=>{n.onMessage(s.data)}}close(){this._transport.close()}send(e){this._transport.send(e)}}class Et{constructor(e,n){this.endpoint=e,this.options=n,this._transport=null}name(){return"websocket"}subName(){return"websocket"}emulation(){return!1}supported(){return this.options.websocket!==void 0&&this.options.websocket!==null}initialize(e,n){let s="";e==="protobuf"&&(s="centrifuge-protobuf"),s!==""?this._transport=new this.options.websocket(this.endpoint,s):this._transport=new this.options.websocket(this.endpoint),e==="protobuf"&&(this._transport.binaryType="arraybuffer"),this._transport.onopen=()=>{n.onOpen()},this._transport.onerror=i=>{n.onError(i)},this._transport.onclose=i=>{n.onClose(i)},this._transport.onmessage=i=>{n.onMessage(i.data)}}close(){this._transport.close()}send(e){this._transport.send(e)}}class Us{constructor(e,n){this.endpoint=e,this.options=n,this._abortController=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"http_stream"}subName(){return"http_stream"}emulation(){return!0}_handleErrors(e){if(!e.ok)throw new Error(e.status);return e}_fetchEventTarget(e,n,s){const i=new EventTarget,r=e.options.fetch;return r(n,s).then(e._handleErrors).then(o=>{i.dispatchEvent(new Event("open"));let c="",u=0,a=new Uint8Array;const f=o.body.getReader();return new e.options.readableStream({start(_){function d(){return f.read().then(({done:l,value:h})=>{if(l){i.dispatchEvent(new Event("close")),_.close();return}try{if(e._protocol==="json")for(c+=e._utf8decoder.decode(h);u<c.length;)if(c[u]===`
`){const m=c.substring(0,u);i.dispatchEvent(new MessageEvent("message",{data:m})),c=c.substring(u+1),u=0}else++u;else{const m=new Uint8Array(a.length+h.length);for(m.set(a),m.set(h,a.length),a=m;;){const p=e.options.decoder.decodeReply(a);if(p.ok){const g=a.slice(0,p.pos);i.dispatchEvent(new MessageEvent("message",{data:g})),a=a.slice(p.pos);continue}break}}}catch(m){i.dispatchEvent(new Event("error",{detail:m})),i.dispatchEvent(new Event("close")),_.close();return}d()}).catch(function(l){i.dispatchEvent(new Event("error",{detail:l})),i.dispatchEvent(new Event("close")),_.close()})}return d()}})}).catch(o=>{i.dispatchEvent(new Event("error",{detail:o})),i.dispatchEvent(new Event("close"))}),i}supported(){return this.options.fetch!==null&&this.options.readableStream!==null&&typeof TextDecoder<"u"&&typeof AbortController<"u"&&typeof EventTarget<"u"&&typeof Event<"u"&&typeof MessageEvent<"u"&&typeof Error<"u"}initialize(e,n,s){this._protocol=e,this._abortController=new AbortController;let i,r;e==="json"?(i={Accept:"application/json","Content-Type":"application/json"},r=s):(i={Accept:"application/octet-stream","Content-Type":"application/octet-stream"},r=s);const o={method:"POST",headers:i,body:r,mode:"cors",credentials:"same-origin",signal:this._abortController.signal},c=this._fetchEventTarget(this,this.endpoint,o);c.addEventListener("open",()=>{n.onOpen()}),c.addEventListener("error",u=>{this._abortController.abort(),n.onError(u)}),c.addEventListener("close",()=>{this._abortController.abort(),n.onClose({code:4,reason:"connection closed"})}),c.addEventListener("message",u=>{n.onMessage(u.data)})}close(){this._abortController.abort()}send(e,n,s){let i,r;const o={session:n,node:s,data:e};this._protocol==="json"?(i={"Content-Type":"application/json"},r=JSON.stringify(o)):(i={"Content-Type":"application/octet-stream"},r=this.options.encoder.encodeEmulationRequest(o));const c=this.options.fetch,u={method:"POST",headers:i,body:r,mode:"cors",credentials:"same-origin"};c(this.options.emulationEndpoint,u)}}class Ns{constructor(e,n){this.endpoint=e,this.options=n,this._protocol="json",this._transport=null,this._onClose=null}name(){return"sse"}subName(){return"sse"}emulation(){return!0}supported(){return this.options.eventsource!==null&&this.options.fetch!==null}initialize(e,n,s){let i;globalThis&&globalThis.document&&globalThis.document.baseURI?i=new URL(this.endpoint,globalThis.document.baseURI):i=new URL(this.endpoint),i.searchParams.append("cf_connect",s);const r={},o=new this.options.eventsource(i.toString(),r);this._transport=o;const c=this;o.onopen=function(){n.onOpen()},o.onerror=function(u){o.close(),n.onError(u),n.onClose({code:4,reason:"connection closed"})},o.onmessage=function(u){n.onMessage(u.data)},c._onClose=function(){n.onClose({code:4,reason:"connection closed"})}}close(){this._transport.close(),this._onClose!==null&&this._onClose()}send(e,n,s){const i={session:n,node:s,data:e},r={"Content-Type":"application/json"},o=JSON.stringify(i),c=this.options.fetch,u={method:"POST",headers:r,body:o,mode:"cors",credentials:"same-origin"};c(this.options.emulationEndpoint,u)}}class As{constructor(e,n){this.endpoint=e,this.options=n,this._transport=null,this._stream=null,this._writer=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"webtransport"}subName(){return"webtransport"}emulation(){return!1}supported(){return this.options.webtransport!==void 0&&this.options.webtransport!==null}initialize(e,n){return O(this,void 0,void 0,function*(){let s;globalThis&&globalThis.document&&globalThis.document.baseURI?s=new URL(this.endpoint,globalThis.document.baseURI):s=new URL(this.endpoint),e==="protobuf"&&s.searchParams.append("cf_protocol","protobuf"),this._protocol=e;const i=new EventTarget;this._transport=new this.options.webtransport(s.toString()),this._transport.closed.then(()=>{n.onClose({code:4,reason:"connection closed"})}).catch(()=>{n.onClose({code:4,reason:"connection closed"})});try{yield this._transport.ready}catch{this.close();return}let r;try{r=yield this._transport.createBidirectionalStream()}catch{this.close();return}this._stream=r,this._writer=this._stream.writable.getWriter(),i.addEventListener("close",()=>{n.onClose({code:4,reason:"connection closed"})}),i.addEventListener("message",o=>{n.onMessage(o.data)}),this._startReading(i),n.onOpen()})}_startReading(e){return O(this,void 0,void 0,function*(){const n=this._stream.readable.getReader();let s="",i=0,r=new Uint8Array;try{for(;;){const{done:o,value:c}=yield n.read();if(c.length>0)if(this._protocol==="json")for(s+=this._utf8decoder.decode(c);i<s.length;)if(s[i]===`
`){const u=s.substring(0,i);e.dispatchEvent(new MessageEvent("message",{data:u})),s=s.substring(i+1),i=0}else++i;else{const u=new Uint8Array(r.length+c.length);for(u.set(r),u.set(c,r.length),r=u;;){const a=this.options.decoder.decodeReply(r);if(a.ok){const f=r.slice(0,a.pos);e.dispatchEvent(new MessageEvent("message",{data:f})),r=r.slice(a.pos);continue}break}}if(o)break}}catch{e.dispatchEvent(new Event("close"))}})}close(){return O(this,void 0,void 0,function*(){try{this._writer&&(yield this._writer.close()),this._transport.close()}catch{}})}send(e){return O(this,void 0,void 0,function*(){let n;this._protocol==="json"?n=new TextEncoder().encode(e+`
`):n=e;try{yield this._writer.write(n)}catch{this.close()}})}}const js=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];class Ms{constructor(e){this.a=e,this.pos=0}haveBytes(){return this.pos<this.a.length}getByte(){const e=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw new RangeError("out of bounds");return e}getChar(){return String.fromCharCode(this.getByte())}getInt(){let e=0,n;for(;this.haveBytes()&&(n=js[127&this.getByte()])>=0;)e=(e<<6)+n;return this.pos--,e>>>0}}class $s{constructor(){this.a=[]}toByteArray(e){return Array.isArray(e)?this.a:new Uint8Array(this.a)}putArray(e,n,s){for(let i=n;i<s;i++)this.a.push(e[i])}}function Ws(t){let e=0,n=0,s=0,i=0,r=0,o=t.length;for(;o>=16;)e=e+t[r+0]|0,n=n+t[r+1]|0,s=s+t[r+2]|0,i=i+t[r+3]|0,e=e+t[r+4]|0,n=n+t[r+5]|0,s=s+t[r+6]|0,i=i+t[r+7]|0,e=e+t[r+8]|0,n=n+t[r+9]|0,s=s+t[r+10]|0,i=i+t[r+11]|0,e=e+t[r+12]|0,n=n+t[r+13]|0,s=s+t[r+14]|0,i=i+t[r+15]|0,r+=16,o-=16;for(;o>=4;)e=e+t[r+0]|0,n=n+t[r+1]|0,s=s+t[r+2]|0,i=i+t[r+3]|0,r+=4,o-=4;switch(i=((i+(s<<8)|0)+(n<<16)|0)+(e<<24)|0,o){case 3:i=i+(t[r+2]<<8)|0;case 2:i=i+(t[r+1]<<16)|0;case 1:i=i+(t[r+0]<<24)|0}return i>>>0}function zs(t,e){let n=0;const s=new Ms(e),i=t.length,r=e.length,o=s.getInt();if(s.getChar()!==`
`)throw new Error("size integer not terminated by '\\n'");const c=new $s;for(;s.haveBytes();){const u=s.getInt();let a;switch(s.getChar()){case"@":if(a=s.getInt(),s.haveBytes()&&s.getChar()!==",")throw new Error("copy command not terminated by ','");if(n+=u,n>o)throw new Error("copy exceeds output file size");if(a+u>i)throw new Error("copy extends past end of input");c.putArray(t,a,a+u);break;case":":if(n+=u,n>o)throw new Error("insert command gives an output larger than predicted");if(u>r)throw new Error("insert count exceeds size of delta");c.putArray(s.a,s.pos,s.pos+u),s.pos+=u;break;case";":{const f=c.toByteArray(t);if(u!==Ws(f))throw new Error("bad checksum");if(n!==o)throw new Error("generated size does not match predicted size");return f}default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")}class Ct{name(){return"json"}encodeCommands(e){return e.map(n=>JSON.stringify(n)).join(`
`)}decodeReplies(e){return e.trim().split(`
`).map(n=>JSON.parse(n))}applyDeltaIfNeeded(e,n){let s,i;if(e.delta){const r=zs(n,new TextEncoder().encode(e.data));s=JSON.parse(new TextDecoder().decode(r)),i=r}else s=JSON.parse(e.data),i=new TextEncoder().encode(e.data);return{newData:s,newPrevValue:i}}}const Hs={headers:{},token:"",getToken:null,data:null,getData:null,debug:!1,name:"js",version:"",fetch:null,readableStream:null,websocket:null,eventsource:null,sockjs:null,sockjsOptions:{},emulationEndpoint:"/emulation",minReconnectDelay:500,maxReconnectDelay:2e4,timeout:5e3,maxServerPingDelay:1e4,networkEventTarget:null};class N extends Error{constructor(e){super(e),this.name=this.constructor.name}}class Te extends bn{constructor(e,n){super(),this._reconnectTimeout=null,this._refreshTimeout=null,this._serverPingTimeout=null,this.state=E.Disconnected,this._transportIsOpen=!1,this._endpoint=e,this._emulation=!1,this._transports=[],this._currentTransportIndex=0,this._triedAllTransports=!1,this._transportWasOpen=!1,this._transport=null,this._transportId=0,this._deviceWentOffline=!1,this._transportClosed=!0,this._codec=new Ct,this._reconnecting=!1,this._reconnectTimeout=null,this._reconnectAttempts=0,this._client=null,this._session="",this._node="",this._subs={},this._serverSubs={},this._commandId=0,this._commands=[],this._batching=!1,this._refreshRequired=!1,this._refreshTimeout=null,this._callbacks={},this._token="",this._data=null,this._dispatchPromise=Promise.resolve(),this._serverPing=0,this._serverPingTimeout=null,this._sendPong=!1,this._promises={},this._promiseId=0,this._debugEnabled=!1,this._networkEventsSet=!1,this._config=Object.assign(Object.assign({},Hs),n),this._configure(),this._debugEnabled?(this.on("state",s=>{this._debug("client state",s.oldState,"->",s.newState)}),this.on("error",s=>{this._debug("client error",s)})):this.on("error",function(){Function.prototype()})}newSubscription(e,n){if(this.getSubscription(e)!==null)throw new Error("Subscription to the channel "+e+" already exists");const s=new Ls(this,e,n);return this._subs[e]=s,s}getSubscription(e){return this._getSub(e)}removeSubscription(e){e&&(e.state!==C.Unsubscribed&&e.unsubscribe(),this._removeSubscription(e))}subscriptions(){return this._subs}ready(e){switch(this.state){case E.Disconnected:return Promise.reject({code:S.clientDisconnected,message:"client disconnected"});case E.Connected:return Promise.resolve();default:return new Promise((n,s)=>{const i={resolve:n,reject:s};e&&(i.timeout=setTimeout(()=>{s({code:S.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=i})}}connect(){if(this._isConnected()){this._debug("connect called when already connected");return}if(this._isConnecting()){this._debug("connect called when already connecting");return}this._debug("connect called"),this._reconnectAttempts=0,this._startConnecting()}disconnect(){this._disconnect(K.disconnectCalled,"disconnect called",!1)}setToken(e){this._token=e}setHeaders(e){this._config.headers=e}send(e){return O(this,void 0,void 0,function*(){const n={send:{data:e}};if(yield this._methodCall(),!this._transportSendCommands([n]))throw this._createErrorObject(S.transportWriteError,"transport write error")})}rpc(e,n){return O(this,void 0,void 0,function*(){const s={rpc:{method:e,data:n}};return yield this._methodCall(),{data:(yield this._callPromise(s,r=>r.rpc)).data}})}publish(e,n){return O(this,void 0,void 0,function*(){const s={publish:{channel:e,data:n}};return yield this._methodCall(),yield this._callPromise(s,()=>({})),{}})}history(e,n){return O(this,void 0,void 0,function*(){const s={history:this._getHistoryRequest(e,n)};yield this._methodCall();const i=yield this._callPromise(s,o=>o.history),r=[];if(i.publications)for(let o=0;o<i.publications.length;o++)r.push(this._getPublicationContext(e,i.publications[o]));return{publications:r,epoch:i.epoch||"",offset:i.offset||0}})}presence(e){return O(this,void 0,void 0,function*(){const n={presence:{channel:e}};yield this._methodCall();const i=(yield this._callPromise(n,r=>r.presence)).presence;for(const r in i)if(Object.prototype.hasOwnProperty.call(i,r)){const o=i[r],c=o.conn_info,u=o.chan_info;c&&(o.connInfo=c),u&&(o.chanInfo=u)}return{clients:i}})}presenceStats(e){return O(this,void 0,void 0,function*(){const n={presence_stats:{channel:e}};yield this._methodCall();const s=yield this._callPromise(n,i=>i.presence_stats);return{numUsers:s.num_users,numClients:s.num_clients}})}startBatching(){this._batching=!0}stopBatching(){const e=this;Promise.resolve().then(function(){Promise.resolve().then(function(){e._batching=!1,e._flush()})})}_debug(...e){this._debugEnabled&&Os("debug",e)}_codecName(){return this._codec.name()}_formatOverride(){}_configure(){if(!("Promise"in globalThis))throw new Error("Promise polyfill required");if(!this._endpoint)throw new Error("endpoint configuration required");if(this._config.token!==null&&(this._token=this._config.token),this._config.data!==null&&(this._data=this._config.data),this._codec=new Ct,this._formatOverride(),(this._config.debug===!0||typeof localStorage<"u"&&localStorage.getItem("centrifuge.debug"))&&(this._debugEnabled=!0),this._debug("config",this._config),typeof this._endpoint!="string")if(typeof this._endpoint=="object"&&this._endpoint instanceof Array){this._transports=this._endpoint,this._emulation=!0;for(const e in this._transports)if(this._transports.hasOwnProperty(e)){const n=this._transports[e];if(!n.endpoint||!n.transport)throw new Error("malformed transport configuration");const s=n.transport;if(["websocket","http_stream","sse","sockjs","webtransport"].indexOf(s)<0)throw new Error("unsupported transport name: "+s)}}else throw new Error("unsupported url configuration type: only string or array of objects are supported")}_setState(e){if(this.state!==e){this._reconnecting=!1;const n=this.state;return this.state=e,this.emit("state",{newState:e,oldState:n}),!0}return!1}_isDisconnected(){return this.state===E.Disconnected}_isConnecting(){return this.state===E.Connecting}_isConnected(){return this.state===E.Connected}_nextCommandId(){return++this._commandId}_setNetworkEvents(){if(this._networkEventsSet)return;let e=null;this._config.networkEventTarget!==null?e=this._config.networkEventTarget:typeof globalThis.addEventListener<"u"&&(e=globalThis),e&&(e.addEventListener("offline",()=>{this._debug("offline event triggered"),(this.state===E.Connected||this.state===E.Connecting)&&(this._disconnect(z.transportClosed,"transport closed",!0),this._deviceWentOffline=!0)}),e.addEventListener("online",()=>{this._debug("online event triggered"),this.state===E.Connecting&&(this._deviceWentOffline&&!this._transportClosed&&(this._deviceWentOffline=!1,this._transportClosed=!0),this._clearReconnectTimeout(),this._startReconnecting())}),this._networkEventsSet=!0)}_getReconnectDelay(){const e=be(this._reconnectAttempts,this._config.minReconnectDelay,this._config.maxReconnectDelay);return this._reconnectAttempts+=1,e}_clearOutgoingRequests(){for(const e in this._callbacks)if(this._callbacks.hasOwnProperty(e)){const n=this._callbacks[e];clearTimeout(n.timeout);const s=n.errback;if(!s)continue;s({error:this._createErrorObject(S.connectionClosed,"connection closed")})}this._callbacks={}}_clearConnectedState(){this._client=null,this._clearServerPingTimeout(),this._clearRefreshTimeout();for(const e in this._subs){if(!this._subs.hasOwnProperty(e))continue;const n=this._subs[e];n.state===C.Subscribed&&n._setSubscribing(pe.transportClosed,"transport closed")}for(const e in this._serverSubs)this._serverSubs.hasOwnProperty(e)&&this.emit("subscribing",{channel:e})}_handleWriteError(e){for(const n of e){const s=n.id;if(!(s in this._callbacks))continue;const i=this._callbacks[s];clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s];const r=i.errback;r({error:this._createErrorObject(S.transportWriteError,"transport write error")})}}_transportSendCommands(e){if(!e.length)return!0;if(!this._transport)return!1;try{this._transport.send(this._codec.encodeCommands(e),this._session,this._node)}catch(n){return this._debug("error writing commands",n),this._handleWriteError(e),!1}return!0}_initializeTransport(){let e;this._config.websocket!==null?e=this._config.websocket:typeof globalThis.WebSocket!="function"&&typeof globalThis.WebSocket!="object"||(e=globalThis.WebSocket);let n=null;this._config.sockjs!==null?n=this._config.sockjs:typeof globalThis.SockJS<"u"&&(n=globalThis.SockJS);let s=null;this._config.eventsource!==null?s=this._config.eventsource:typeof globalThis.EventSource<"u"&&(s=globalThis.EventSource);let i=null;this._config.fetch!==null?i=this._config.fetch:typeof globalThis.fetch<"u"&&(i=globalThis.fetch);let r=null;if(this._config.readableStream!==null?r=this._config.readableStream:typeof globalThis.ReadableStream<"u"&&(r=globalThis.ReadableStream),this._emulation){this._currentTransportIndex>=this._transports.length&&(this._triedAllTransports=!0,this._currentTransportIndex=0);let l=0;for(;;){if(l>=this._transports.length)throw new Error("no supported transport found");const h=this._transports[this._currentTransportIndex],m=h.transport,p=h.endpoint;if(m==="websocket"){if(this._debug("trying websocket transport"),this._transport=new Et(p,{websocket:e}),!this._transport.supported()){this._debug("websocket transport not available"),this._currentTransportIndex++,l++;continue}}else if(m==="webtransport"){if(this._debug("trying webtransport transport"),this._transport=new As(p,{webtransport:globalThis.WebTransport,decoder:this._codec,encoder:this._codec}),!this._transport.supported()){this._debug("webtransport transport not available"),this._currentTransportIndex++,l++;continue}}else if(m==="http_stream"){if(this._debug("trying http_stream transport"),this._transport=new Us(p,{fetch:i,readableStream:r,emulationEndpoint:this._config.emulationEndpoint,decoder:this._codec,encoder:this._codec}),!this._transport.supported()){this._debug("http_stream transport not available"),this._currentTransportIndex++,l++;continue}}else if(m==="sse"){if(this._debug("trying sse transport"),this._transport=new Ns(p,{eventsource:s,fetch:i,emulationEndpoint:this._config.emulationEndpoint}),!this._transport.supported()){this._debug("sse transport not available"),this._currentTransportIndex++,l++;continue}}else if(m==="sockjs"){if(this._debug("trying sockjs"),this._transport=new Ds(p,{sockjs:n,sockjsOptions:this._config.sockjsOptions}),!this._transport.supported()){this._debug("sockjs transport not available"),this._currentTransportIndex++,l++;continue}}else throw new Error("unknown transport "+m);break}}else{if(Rs(this._endpoint,"http"))throw new Error("Provide explicit transport endpoints configuration in case of using HTTP (i.e. using array of TransportEndpoint instead of a single string), or use ws(s):// scheme in an endpoint if you aimed using WebSocket transport");if(this._debug("client will use websocket"),this._transport=new Et(this._endpoint,{websocket:e}),!this._transport.supported())throw new Error("WebSocket constructor not found, make sure it is available globally or passed as a dependency in Centrifuge options")}const o=this,c=this._transport,u=this._nextTransportId();o._debug("id of transport",u);let a=!1;const f=[];if(this._transport.emulation()){const l=o._sendConnect(!0);f.push(l)}this._setNetworkEvents();const _=this._codec.encodeCommands(f);this._transportClosed=!1;let d;d=setTimeout(function(){c.close()},this._config.timeout),this._transport.initialize(this._codecName(),{onOpen:function(){if(d&&(clearTimeout(d),d=null),o._transportId!=u){o._debug("open callback from non-actual transport"),c.close();return}a=!0,o._debug(c.subName(),"transport open"),!c.emulation()&&(o._transportIsOpen=!0,o._transportWasOpen=!0,o.startBatching(),o._sendConnect(!1),o._sendSubscribeCommands(),o.stopBatching(),o.emit("__centrifuge_debug:connect_frame_sent",{}))},onError:function(l){if(o._transportId!=u){o._debug("error callback from non-actual transport");return}o._debug("transport level error",l)},onClose:function(l){if(d&&(clearTimeout(d),d=null),o._transportId!=u){o._debug("close callback from non-actual transport");return}o._debug(c.subName(),"transport closed"),o._transportClosed=!0,o._transportIsOpen=!1;let h="connection closed",m=!0,p=0;if(l&&"code"in l&&l.code&&(p=l.code),l&&l.reason)try{const g=JSON.parse(l.reason);h=g.reason,m=g.reconnect}catch{h=l.reason,(p>=3500&&p<4e3||p>=4500&&p<5e3)&&(m=!1)}p<3e3?(p===1009?(p=K.messageSizeLimit,h="message size limit exceeded",m=!1):(p=z.transportClosed,h="transport closed"),o._emulation&&!o._transportWasOpen&&(o._currentTransportIndex++,o._currentTransportIndex>=o._transports.length&&(o._triedAllTransports=!0,o._currentTransportIndex=0))):o._transportWasOpen=!0,o._isConnecting()&&!a&&o.emit("error",{type:"transport",error:{code:S.transportClosed,message:"transport closed"},transport:c.name()}),o._reconnecting=!1,o._disconnect(p,h,m)},onMessage:function(l){o._dataReceived(l)}},_),o.emit("__centrifuge_debug:transport_initialized",{})}_sendConnect(e){const n=this._constructConnectCommand(),s=this;return this._call(n,e).then(i=>{const r=i.reply.connect;s._connectResponse(r),i.next&&i.next()},i=>{s._connectError(i.error),i.next&&i.next()}),n}_startReconnecting(){if(this._debug("start reconnecting"),!this._isConnecting()){this._debug("stop reconnecting: client not in connecting state");return}if(this._reconnecting){this._debug("reconnect already in progress, return from reconnect routine");return}if(this._transportClosed===!1){this._debug("waiting for transport close");return}this._reconnecting=!0;const e=this._token==="";if(!(this._refreshRequired||e&&this._config.getToken!==null)){this._config.getData?this._config.getData().then(i=>{this._isConnecting()&&(this._data=i,this._initializeTransport())}).catch(i=>this._handleGetDataError(i)):this._initializeTransport();return}const s=this;this._getToken().then(function(i){if(s._isConnecting()){if(i==null||i==null){s._failUnauthorized();return}s._token=i,s._debug("connection token refreshed"),s._config.getData?s._config.getData().then(function(r){s._isConnecting()&&(s._data=r,s._initializeTransport())}).catch(r=>s._handleGetDataError(r)):s._initializeTransport()}}).catch(function(i){if(!s._isConnecting())return;if(i instanceof N){s._failUnauthorized();return}s.emit("error",{type:"connectToken",error:{code:S.clientConnectToken,message:i!==void 0?i.toString():""}});const r=s._getReconnectDelay();s._debug("error on getting connection token, reconnect after "+r+" milliseconds",i),s._reconnecting=!1,s._reconnectTimeout=setTimeout(()=>{s._startReconnecting()},r)})}_handleGetDataError(e){if(e instanceof N){this._failUnauthorized();return}this.emit("error",{type:"connectData",error:{code:S.badConfiguration,message:e?.toString()||""}});const n=this._getReconnectDelay();this._debug("error on getting connect data, reconnect after "+n+" milliseconds",e),this._reconnecting=!1,this._reconnectTimeout=setTimeout(()=>{this._startReconnecting()},n)}_connectError(e){this.state===E.Connecting&&(e.code===109&&(this._refreshRequired=!0),e.code<100||e.temporary===!0||e.code===109?(this.emit("error",{type:"connect",error:e}),this._debug("closing transport due to connect error"),this._disconnect(e.code,e.message,!0)):this._disconnect(e.code,e.message,!1))}_scheduleReconnect(){if(!this._isConnecting())return;let e=!1;this._emulation&&!this._transportWasOpen&&!this._triedAllTransports&&(e=!0);let n=this._getReconnectDelay();e&&(n=0),this._debug("reconnect after "+n+" milliseconds"),this._clearReconnectTimeout(),this._reconnectTimeout=setTimeout(()=>{this._startReconnecting()},n)}_constructConnectCommand(){const e={};this._token&&(e.token=this._token),this._data&&(e.data=this._data),this._config.name&&(e.name=this._config.name),this._config.version&&(e.version=this._config.version),Object.keys(this._config.headers).length>0&&(e.headers=this._config.headers);const n={};let s=!1;for(const i in this._serverSubs)if(this._serverSubs.hasOwnProperty(i)&&this._serverSubs[i].recoverable){s=!0;const r={recover:!0};this._serverSubs[i].offset&&(r.offset=this._serverSubs[i].offset),this._serverSubs[i].epoch&&(r.epoch=this._serverSubs[i].epoch),n[i]=r}return s&&(e.subs=n),{connect:e}}_getHistoryRequest(e,n){const s={channel:e};return n!==void 0&&(n.since&&(s.since={offset:n.since.offset},n.since.epoch&&(s.since.epoch=n.since.epoch)),n.limit!==void 0&&(s.limit=n.limit),n.reverse===!0&&(s.reverse=!0)),s}_methodCall(){return this._isConnected()?Promise.resolve():new Promise((e,n)=>{const s=setTimeout(function(){n({code:S.timeout,message:"timeout"})},this._config.timeout);this._promises[this._nextPromiseId()]={timeout:s,resolve:e,reject:n}})}_callPromise(e,n){return new Promise((s,i)=>{this._call(e,!1).then(r=>{var o;const c=n(r.reply);s(c),(o=r.next)===null||o===void 0||o.call(r)},r=>{var o;i(r.error),(o=r.next)===null||o===void 0||o.call(r)})})}_dataReceived(e){this._serverPing>0&&this._waitServerPing();const n=this._codec.decodeReplies(e);this._dispatchPromise=this._dispatchPromise.then(()=>{let s;this._dispatchPromise=new Promise(i=>{s=i}),this._dispatchSynchronized(n,s)})}_dispatchSynchronized(e,n){let s=Promise.resolve();for(const i in e)e.hasOwnProperty(i)&&(s=s.then(()=>this._dispatchReply(e[i])));s=s.then(()=>{n()})}_dispatchReply(e){let n;const s=new Promise(r=>{n=r});if(e==null)return this._debug("dispatch: got undefined or null reply"),n(),s;const i=e.id;return i&&i>0?this._handleReply(e,n):e.push?this._handlePush(e.push,n):this._handleServerPing(n),s}_call(e,n){return new Promise((s,i)=>{e.id=this._nextCommandId(),this._registerCall(e.id,s,i),n||this._addCommand(e)})}_startConnecting(){this._debug("start connecting"),this._setState(E.Connecting)&&this.emit("connecting",{code:z.connectCalled,reason:"connect called"}),this._client=null,this._startReconnecting()}_disconnect(e,n,s){if(this._isDisconnected())return;this._transportIsOpen=!1;const i=this.state;this._reconnecting=!1;const r={code:e,reason:n};let o=!1;if(s?o=this._setState(E.Connecting):(o=this._setState(E.Disconnected),this._rejectPromises({code:S.clientDisconnected,message:"disconnected"})),this._clearOutgoingRequests(),i===E.Connecting&&this._clearReconnectTimeout(),i===E.Connected&&this._clearConnectedState(),o&&(this._isConnecting()?this.emit("connecting",r):this.emit("disconnected",r)),this._transport){this._debug("closing existing transport");const c=this._transport;this._transport=null,c.close(),this._transportClosed=!0,this._nextTransportId()}else this._debug("no transport to close");this._scheduleReconnect()}_failUnauthorized(){this._disconnect(K.unauthorized,"unauthorized",!1)}_getToken(){return this._debug("get connection token"),this._config.getToken?this._config.getToken({}):(this.emit("error",{type:"configuration",error:{code:S.badConfiguration,message:"token expired but no getToken function set in the configuration"}}),Promise.reject(new N("")))}_refresh(){const e=this._client,n=this;this._getToken().then(function(s){if(e!==n._client)return;if(!s){n._failUnauthorized();return}if(n._token=s,n._debug("connection token refreshed"),!n._isConnected())return;const i={refresh:{token:n._token}};n._call(i,!1).then(r=>{const o=r.reply.refresh;n._refreshResponse(o),r.next&&r.next()},r=>{n._refreshError(r.error),r.next&&r.next()})}).catch(function(s){if(n._isConnected()){if(s instanceof N){n._failUnauthorized();return}n.emit("error",{type:"refreshToken",error:{code:S.clientRefreshToken,message:s!==void 0?s.toString():""}}),n._refreshTimeout=setTimeout(()=>n._refresh(),n._getRefreshRetryDelay())}})}_refreshError(e){e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._disconnect(e.code,e.message,!1)}_getRefreshRetryDelay(){return be(0,5e3,1e4)}_refreshResponse(e){this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),e.expires&&(this._client=e.client,this._refreshTimeout=setTimeout(()=>this._refresh(),ge(e.ttl)))}_removeSubscription(e){e!==null&&delete this._subs[e.channel]}_unsubscribe(e){if(!this._transportIsOpen)return Promise.resolve();const s={unsubscribe:{channel:e.channel}},i=this;return new Promise((o,c)=>{this._call(s,!1).then(u=>{o(),u.next&&u.next()},u=>{o(),u.next&&u.next(),i._disconnect(z.unsubscribeError,"unsubscribe error",!0)})})}_getSub(e){const n=this._subs[e];return n||null}_isServerSub(e){return this._serverSubs[e]!==void 0}_sendSubscribeCommands(){const e=[];for(const n in this._subs){if(!this._subs.hasOwnProperty(n))continue;const s=this._subs[n];if(s._inflight!==!0&&s.state===C.Subscribing){const i=s._subscribe();i&&e.push(i)}}return e}_connectResponse(e){if(this._transportIsOpen=!0,this._transportWasOpen=!0,this._reconnectAttempts=0,this._refreshRequired=!1,this._isConnected())return;this._client=e.client,this._setState(E.Connected),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout(()=>this._refresh(),ge(e.ttl))),this._session=e.session,this._node=e.node,this.startBatching(),this._sendSubscribeCommands(),this.stopBatching();const n={client:e.client,transport:this._transport.subName()};e.data&&(n.data=e.data),this.emit("connected",n),this._resolvePromises(),this._processServerSubs(e.subs||{}),e.ping&&e.ping>0?(this._serverPing=e.ping*1e3,this._sendPong=e.pong===!0,this._waitServerPing()):this._serverPing=0}_processServerSubs(e){for(const n in e){if(!e.hasOwnProperty(n))continue;const s=e[n];this._serverSubs[n]={offset:s.offset,epoch:s.epoch,recoverable:s.recoverable||!1};const i=this._getSubscribeContext(n,s);this.emit("subscribed",i)}for(const n in e){if(!e.hasOwnProperty(n))continue;const s=e[n];if(s.recovered){const i=s.publications;if(i&&i.length>0)for(const r in i)i.hasOwnProperty(r)&&this._handlePublication(n,i[r])}}for(const n in this._serverSubs)this._serverSubs.hasOwnProperty(n)&&(e[n]||(this.emit("unsubscribed",{channel:n}),delete this._serverSubs[n]))}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearReconnectTimeout(){this._reconnectTimeout!==null&&(clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null)}_clearServerPingTimeout(){this._serverPingTimeout!==null&&(clearTimeout(this._serverPingTimeout),this._serverPingTimeout=null)}_waitServerPing(){this._config.maxServerPingDelay!==0&&this._isConnected()&&(this._clearServerPingTimeout(),this._serverPingTimeout=setTimeout(()=>{this._isConnected()&&this._disconnect(z.noPing,"no ping",!0)},this._serverPing+this._config.maxServerPingDelay))}_getSubscribeContext(e,n){const s={channel:e,positioned:!1,recoverable:!1,wasRecovering:!1,recovered:!1,hasRecoveredPublications:!1};n.recovered&&(s.recovered=!0),n.positioned&&(s.positioned=!0),n.recoverable&&(s.recoverable=!0),n.was_recovering&&(s.wasRecovering=!0);let i="";"epoch"in n&&(i=n.epoch);let r=0;return"offset"in n&&(r=n.offset),(s.positioned||s.recoverable)&&(s.streamPosition={offset:r,epoch:i}),Array.isArray(n.publications)&&n.publications.length>0&&(s.hasRecoveredPublications=!0),n.data&&(s.data=n.data),s}_handleReply(e,n){const s=e.id;if(!(s in this._callbacks)){n();return}const i=this._callbacks[s];if(clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s],Is(e)){const r=i.errback;if(!r){n();return}const o={code:e.error.code,message:e.error.message||"",temporary:e.error.temporary||!1};r({error:o,next:n})}else{const r=i.callback;if(!r)return;r({reply:e,next:n})}}_handleJoin(e,n){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const i={channel:e,info:this._getJoinLeaveContext(n.info)};this.emit("join",i)}return}s._handleJoin(n)}_handleLeave(e,n){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const i={channel:e,info:this._getJoinLeaveContext(n.info)};this.emit("leave",i)}return}s._handleLeave(n)}_handleUnsubscribe(e,n){const s=this._getSub(e);if(!s){this._isServerSub(e)&&(delete this._serverSubs[e],this.emit("unsubscribed",{channel:e}));return}n.code<2500?s._setUnsubscribed(n.code,n.reason,!1):s._setSubscribing(n.code,n.reason)}_handleSubscribe(e,n){this._serverSubs[e]={offset:n.offset,epoch:n.epoch,recoverable:n.recoverable||!1},this.emit("subscribed",this._getSubscribeContext(e,n))}_handleDisconnect(e){const n=e.code;let s=!0;(n>=3500&&n<4e3||n>=4500&&n<5e3)&&(s=!1),this._disconnect(n,e.reason,s)}_getPublicationContext(e,n){const s={channel:e,data:n.data};return n.offset&&(s.offset=n.offset),n.info&&(s.info=this._getJoinLeaveContext(n.info)),n.tags&&(s.tags=n.tags),s}_getJoinLeaveContext(e){const n={client:e.client,user:e.user},s=e.conn_info;s&&(n.connInfo=s);const i=e.chan_info;return i&&(n.chanInfo=i),n}_handlePublication(e,n){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const i=this._getPublicationContext(e,n);this.emit("publication",i),n.offset!==void 0&&(this._serverSubs[e].offset=n.offset)}return}s._handlePublication(n)}_handleMessage(e){this.emit("message",{data:e.data})}_handleServerPing(e){if(this._sendPong){const n={};this._transportSendCommands([n])}e()}_handlePush(e,n){const s=e.channel;e.pub?this._handlePublication(s,e.pub):e.message?this._handleMessage(e.message):e.join?this._handleJoin(s,e.join):e.leave?this._handleLeave(s,e.leave):e.unsubscribe?this._handleUnsubscribe(s,e.unsubscribe):e.subscribe?this._handleSubscribe(s,e.subscribe):e.disconnect&&this._handleDisconnect(e.disconnect),n()}_flush(){const e=this._commands.slice(0);this._commands=[],this._transportSendCommands(e)}_createErrorObject(e,n,s){const i={code:e,message:n};return s&&(i.temporary=!0),i}_registerCall(e,n,s){this._callbacks[e]={callback:n,errback:s,timeout:null},this._callbacks[e].timeout=setTimeout(()=>{delete this._callbacks[e],gn(s)&&s({error:this._createErrorObject(S.timeout,"timeout")})},this._config.timeout)}_addCommand(e){this._batching?this._commands.push(e):this._transportSendCommands([e])}_nextPromiseId(){return++this._promiseId}_nextTransportId(){return++this._transportId}_resolvePromises(){for(const e in this._promises)this._promises.hasOwnProperty(e)&&(this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e])}_rejectPromises(e){for(const n in this._promises)this._promises.hasOwnProperty(n)&&(this._promises[n].timeout&&clearTimeout(this._promises[n].timeout),this._promises[n].reject(e),delete this._promises[n])}}Te.SubscriptionState=C;Te.State=E;Te.UnauthorizedError=N;function Fs(t,e){const n=T.socket=new Te(t);n.setToken(e),n.on("connected",s=>{T.connected=!0,T.taskQueue.forEach(i=>i()),T.taskQueue=[],T.socketId=s.client}),n.on("disconnected",s=>{T.connected=!1}),n.on("error",s=>{T.connected=!1}),n.connect()}function vn(t,e){return t.key+"_"+e.eventName}function qs(t,e){const n=T.listeners.get(t.key);if(!n)return;const s=e.data,i=n.get(vn(t,s));i&&i.forEach(r=>{try{r(e.data.payload)}catch{console.error("handleIncomingMessage",t,e)}})}function Qe(t){return new Promise((e,n)=>{let s=T.socket.getSubscription(t.key);s?.state===C.Subscribed&&e({subscription:s});const i=()=>{s=T.socket.getSubscription(t.key),s?.state!==C.Subscribed&&(s?(s.subscribe(),e({subscription:s})):(s=T.socket.newSubscription(t.key),vs("%c subscribed on "+t.key,"color: #0f0"),s.on("publication",r=>{qs(t,r)}),s.on("subscribed",()=>{e({subscription:s})}),s.subscribe()))};T.connected?i():T.taskQueue.push(i)})}function Bs(t){return T.listeners.get(t.key)||T.emitters.get(t.key)}function Js(t){if(Bs(t))return;const n=T.socket.getSubscription(t.key);n&&n.unsubscribe()}function Vs(){return Math.random().toString(36).substring(2)}function Gs(t,e,n){Qe(t),T.listeners.has(t.key)||T.listeners.set(t.key,new Map);const s=T.listeners.get(t.key),i=vn(t,e);s.has(i)||s.set(i,new Map);const r=s.get(i),o=i+"--"+Vs();return r.set(o,n),()=>{r.delete(o),r.size===0&&s.delete(i),s.size===0&&T.listeners.delete(t.key),Js(t)}}function Qs(t,e){return typeof t.transform=="function"?t.transform(t.eventName,e):{eventName:t.eventName,payload:e}}async function Zs(t,e,n){try{const s=(await Qe(t)).subscription,i=Qs(e,n);await s.publish(i)}catch(s){console.error(t,e,n,s)}}let fe={ICE_CANDIDATE:new Re,OFFER:new Re,ANSWER:new Re};gs(fe);function Xs(t,e){const n=[],s={key:"conf_"+e};return{off:()=>n.forEach(i=>i()),offer:Oe(s,fe.OFFER,n),answer:Oe(s,fe.ANSWER,n),iceCandidate:Oe(s,fe.ICE_CANDIDATE,n),setUserIdList:null,async connect(){const i=async()=>await this.setUserIdList(Object.keys((await r.presence()).clients)),{subscription:r}=await Qe(s);r.on("join",async()=>await i()),r.on("leave",async()=>await i()),await i()}}}function Oe(t,e,n){return{async emit(s){await Zs(t,e,s)},on(s){n.push(Gs(t,e,s))}}}async function Ys(){const t="https://chessclub.spb.ru/rest/auth.rest.jwt",{session:e}=await Ks(new XMLHttpRequest,t,"userId","test-client"),n="wss://chessclub.spb.ru/centrifugo/connection/websocket";return new Promise(s=>{Fs(n,e),T.socket.on("connected",()=>{s(T.socketId)})})}async function Ks(t,e,n,s){return new Promise((i,r)=>{t.open("POST",e),t.onload=()=>i(JSON.parse(t.response||t.responseText)),t.onerror=r,t.send(JSON.stringify({user_id:n,name:s}))})}const xe=we({prefix:"[AppStore]",color:"#ddd"}),yn=an((t,e)=>{const n=bs();return n.onChange=async s=>{xe("users changed",s),t({otherUsers:[...e().otherUsers]})},n.onJoin=async s=>{xe("users joined",s),t({otherUsers:[...e().otherUsers,...s]})},n.onLeft=async s=>{xe("users left",s);const i=[...e().otherUsers];s.forEach(r=>{const o=i.find(c=>c.userId===r.userId);i.splice(i.indexOf(o),1)}),t({otherUsers:i})},{otherUsers:[],async updateTracks(){const s=Se.getState().getActualTracks();n.updateTracks(s)},async enter(s,i){const r=Xs(s,i);await n.connect(s,r)}}});function ei(){const{updateTracks:t,otherUsers:e}=yn(),n=Se();async function s(){await(n.cameraStreamTrack?n.stopCameraStream:n.startCameraStream)(),await t()}async function i(){await(n.microphoneStreamTrack?n.stopMicrophoneStream:n.startMicrophoneStream)(),await t()}async function r(){await(n.desktopStreamTrack?n.stopDesktopStream:n.startDesktopStream)(),await t()}return R("div",{children:[R("button",{onClick:s,children:n.cameraStreamTrack?"disable cam":"enable cam"}),R("button",{onClick:i,children:n.microphoneStreamTrack?"disable mic":"enable mic"}),R("button",{onClick:r,children:(n.desktopStreamTrack,"share screen")}),R("div",{children:[R(Pt,{tracks:n.getActualTracks(!0),connection:"self"}),e.map(o=>R(Pt,{tracks:o.tracks,connection:o.status},o.userId))]})]})}const Pt=re(({tracks:t,connection:e})=>R("div",{style:{border:"1px solid black",width:300,minHeight:200},children:[R("div",{children:["tracks: ",t.length," connection: ",e]}),t.map(n=>R(ti,{track:n},n.id))]})),ti=re(({track:t})=>t.kind==="audio"?R(ni,{track:t}):R(si,{track:t})),ni=re(({track:t})=>R("audio",{autoplay:!0,playsInline:!0,srcObject:new MediaStream([t])})),si=re(({track:t})=>R("video",{width:300,muted:!0,autoPlay:!0,playsinline:!0,playsInline:!0,srcObject:new MediaStream([t])}));function ii(t){return{render:function(e){on(e,t)},unmount:function(){cn(t)}}}function ri(t=""){const e=s=>t+"_"+s,n=e("quality");return{setEnabled(s,i){i?localStorage.setItem(e(s),"true"):localStorage.removeItem(e(s))},isEnabled(s){return!!localStorage.getItem(e(s))},setQuality(s){localStorage.setItem(n,s)},getQuality(){const s=localStorage.getItem(n);return s?I[s]:I.LOW}}}(async()=>{await Se.getState().restore(ri()),ii(document.getElementById("root")).render(R(ei,{}));const t=await Ys();yn.getState().enter(t,"deadbeefx")})();
