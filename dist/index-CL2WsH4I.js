(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var se,b,It,q,Ke,xt,Lt,Dt,ze,De,Ue,Ut,te={},Nt=[],wn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,re=Array.isArray;function D(t,e){for(var n in e)t[n]=e[n];return t}function He(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function M(t,e,n){var s,r,i,o={};for(i in e)i=="key"?s=e[i]:i=="ref"?r=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?se.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)o[i]===void 0&&(o[i]=t.defaultProps[i]);return K(t,o,s,r,null)}function K(t,e,n,s,r){var i={type:t,props:e,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++It,__i:-1,__u:0};return r==null&&b.vnode!=null&&b.vnode(i),i}function kn(){return{current:null}}function $(t){return t.children}function U(t,e){this.props=t,this.context=e}function V(t,e){if(e==null)return t.__?V(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?V(t):null}function At(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return At(t)}}function Ne(t){(!t.__d&&(t.__d=!0)&&q.push(t)&&!pe.__r++||Ke!=b.debounceRendering)&&((Ke=b.debounceRendering)||xt)(pe)}function pe(){for(var t,e,n,s,r,i,o,c=1;q.length;)q.length>c&&q.sort(Lt),t=q.shift(),c=q.length,t.__d&&(n=void 0,s=void 0,r=(s=(e=t).__v).__e,i=[],o=[],e.__P&&((n=D({},s)).__v=s.__v+1,b.vnode&&b.vnode(n),Fe(e.__P,n,s,e.__n,e.__P.namespaceURI,32&s.__u?[r]:null,i,r??V(s),!!(32&s.__u),o),n.__v=s.__v,n.__.__k[n.__i]=n,$t(i,n,o),s.__e=s.__=null,n.__e!=r&&At(n)));pe.__r=0}function jt(t,e,n,s,r,i,o,c,u,a,f){var _,d,l,h,m,p,g,v=s&&s.__k||Nt,N=e.length;for(u=Tn(n,e,v,u,N),_=0;_<N;_++)(l=n.__k[_])!=null&&(d=l.__i==-1?te:v[l.__i]||te,l.__i=_,p=Fe(t,l,d,r,i,o,c,u,a,f),h=l.__e,l.ref&&d.ref!=l.ref&&(d.ref&&qe(d.ref,null,l),f.push(l.ref,l.__c||h,l)),m==null&&h!=null&&(m=h),(g=!!(4&l.__u))||d.__k===l.__k?u=Mt(l,u,t,g):typeof l.type=="function"&&p!==void 0?u=p:h&&(u=h.nextSibling),l.__u&=-7);return n.__e=m,u}function Tn(t,e,n,s,r){var i,o,c,u,a,f=n.length,_=f,d=0;for(t.__k=new Array(r),i=0;i<r;i++)(o=e[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(u=i+d,(o=t.__k[i]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?K(null,o,null,null,null):re(o)?K($,{children:o},null,null,null):o.constructor==null&&o.__b>0?K(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,c=null,(a=o.__i=En(o,n,u,_))!=-1&&(_--,(c=n[a])&&(c.__u|=2)),c==null||c.__v==null?(a==-1&&(r>f?d--:r<f&&d++),typeof o.type!="function"&&(o.__u|=4)):a!=u&&(a==u-1?d--:a==u+1?d++:(a>u?d--:d++,o.__u|=4))):t.__k[i]=null;if(_)for(i=0;i<f;i++)(c=n[i])!=null&&(2&c.__u)==0&&(c.__e==s&&(s=V(c)),zt(c,c));return s}function Mt(t,e,n,s){var r,i;if(typeof t.type=="function"){for(r=t.__k,i=0;r&&i<r.length;i++)r[i]&&(r[i].__=t,e=Mt(r[i],e,n,s));return e}t.__e!=e&&(s&&(e&&t.type&&!e.parentNode&&(e=V(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function j(t,e){return e=e||[],t==null||typeof t=="boolean"||(re(t)?t.some(function(n){j(n,e)}):e.push(t)),e}function En(t,e,n,s){var r,i,o,c=t.key,u=t.type,a=e[n],f=a!=null&&(2&a.__u)==0;if(a===null&&t.key==null||f&&c==a.key&&u==a.type)return n;if(s>(f?1:0)){for(r=n-1,i=n+1;r>=0||i<e.length;)if((a=e[o=r>=0?r--:i++])!=null&&(2&a.__u)==0&&c==a.key&&u==a.type)return o}return-1}function et(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||wn.test(e)?n:n+"px"}function ue(t,e,n,s,r){var i,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)n&&e in n||et(t.style,e,"");if(n)for(e in n)s&&n[e]==s[e]||et(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(Dt,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?s?n.u=s.u:(n.u=ze,t.addEventListener(e,i?Ue:De,i)):t.removeEventListener(e,i?Ue:De,i);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function tt(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=ze++;else if(e.t<n.u)return;return n(b.event?b.event(e):e)}}}function Fe(t,e,n,s,r,i,o,c,u,a){var f,_,d,l,h,m,p,g,v,N,W,ce,Z,Ye,ae,X,Pe,L=e.type;if(e.constructor!=null)return null;128&n.__u&&(u=!!(32&n.__u),i=[c=e.__e=n.__e]),(f=b.__b)&&f(e);e:if(typeof L=="function")try{if(g=e.props,v="prototype"in L&&L.prototype.render,N=(f=L.contextType)&&s[f.__c],W=f?N?N.props.value:f.__:s,n.__c?p=(_=e.__c=n.__c).__=_.__E:(v?e.__c=_=new L(g,W):(e.__c=_=new U(g,W),_.constructor=L,_.render=Pn),N&&N.sub(_),_.props=g,_.state||(_.state={}),_.context=W,_.__n=s,d=_.__d=!0,_.__h=[],_._sb=[]),v&&_.__s==null&&(_.__s=_.state),v&&L.getDerivedStateFromProps!=null&&(_.__s==_.state&&(_.__s=D({},_.__s)),D(_.__s,L.getDerivedStateFromProps(g,_.__s))),l=_.props,h=_.state,_.__v=e,d)v&&L.getDerivedStateFromProps==null&&_.componentWillMount!=null&&_.componentWillMount(),v&&_.componentDidMount!=null&&_.__h.push(_.componentDidMount);else{if(v&&L.getDerivedStateFromProps==null&&g!==l&&_.componentWillReceiveProps!=null&&_.componentWillReceiveProps(g,W),!_.__e&&_.shouldComponentUpdate!=null&&_.shouldComponentUpdate(g,_.__s,W)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(_.props=g,_.state=_.__s,_.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(B){B&&(B.__=e)}),ce=0;ce<_._sb.length;ce++)_.__h.push(_._sb[ce]);_._sb=[],_.__h.length&&o.push(_);break e}_.componentWillUpdate!=null&&_.componentWillUpdate(g,_.__s,W),v&&_.componentDidUpdate!=null&&_.__h.push(function(){_.componentDidUpdate(l,h,m)})}if(_.context=W,_.props=g,_.__P=t,_.__e=!1,Z=b.__r,Ye=0,v){for(_.state=_.__s,_.__d=!1,Z&&Z(e),f=_.render(_.props,_.state,_.context),ae=0;ae<_._sb.length;ae++)_.__h.push(_._sb[ae]);_._sb=[]}else do _.__d=!1,Z&&Z(e),f=_.render(_.props,_.state,_.context),_.state=_.__s;while(_.__d&&++Ye<25);_.state=_.__s,_.getChildContext!=null&&(s=D(D({},s),_.getChildContext())),v&&!d&&_.getSnapshotBeforeUpdate!=null&&(m=_.getSnapshotBeforeUpdate(l,h)),X=f,f!=null&&f.type===$&&f.key==null&&(X=Wt(f.props.children)),c=jt(t,re(X)?X:[X],e,n,s,r,i,o,c,u,a),_.base=e.__e,e.__u&=-161,_.__h.length&&o.push(_),p&&(_.__E=_.__=null)}catch(B){if(e.__v=null,u||i!=null)if(B.then){for(e.__u|=u?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;i[i.indexOf(c)]=null,e.__e=c}else{for(Pe=i.length;Pe--;)He(i[Pe]);Ae(e)}else e.__e=n.__e,e.__k=n.__k,B.then||Ae(e);b.__e(B,e,n)}else i==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):c=e.__e=Cn(n.__e,e,n,s,r,i,o,u,a);return(f=b.diffed)&&f(e),128&e.__u?void 0:c}function Ae(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(Ae)}function $t(t,e,n){for(var s=0;s<n.length;s++)qe(n[s],n[++s],n[++s]);b.__c&&b.__c(e,t),t.some(function(r){try{t=r.__h,r.__h=[],t.some(function(i){i.call(r)})}catch(i){b.__e(i,r.__v)}})}function Wt(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:re(t)?t.map(Wt):D({},t)}function Cn(t,e,n,s,r,i,o,c,u){var a,f,_,d,l,h,m,p=n.props,g=e.props,v=e.type;if(v=="svg"?r="http://www.w3.org/2000/svg":v=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),i!=null){for(a=0;a<i.length;a++)if((l=i[a])&&"setAttribute"in l==!!v&&(v?l.localName==v:l.nodeType==3)){t=l,i[a]=null;break}}if(t==null){if(v==null)return document.createTextNode(g);t=document.createElementNS(r,v,g.is&&g),c&&(b.__m&&b.__m(e,i),c=!1),i=null}if(v==null)p===g||c&&t.data==g||(t.data=g);else{if(i=i&&se.call(t.childNodes),p=n.props||te,!c&&i!=null)for(p={},a=0;a<t.attributes.length;a++)p[(l=t.attributes[a]).name]=l.value;for(a in p)if(l=p[a],a!="children"){if(a=="dangerouslySetInnerHTML")_=l;else if(!(a in g)){if(a=="value"&&"defaultValue"in g||a=="checked"&&"defaultChecked"in g)continue;ue(t,a,null,l,r)}}for(a in g)l=g[a],a=="children"?d=l:a=="dangerouslySetInnerHTML"?f=l:a=="value"?h=l:a=="checked"?m=l:c&&typeof l!="function"||p[a]===l||ue(t,a,l,p[a],r);if(f)c||_&&(f.__html==_.__html||f.__html==t.innerHTML)||(t.innerHTML=f.__html),e.__k=[];else if(_&&(t.innerHTML=""),jt(e.type=="template"?t.content:t,re(d)?d:[d],e,n,s,v=="foreignObject"?"http://www.w3.org/1999/xhtml":r,i,o,i?i[0]:n.__k&&V(n,0),c,u),i!=null)for(a=i.length;a--;)He(i[a]);c||(a="value",v=="progress"&&h==null?t.removeAttribute("value"):h!=null&&(h!==t[a]||v=="progress"&&!h||v=="option"&&h!=p[a])&&ue(t,a,h,p[a],r),a="checked",m!=null&&m!=t[a]&&ue(t,a,m,p[a],r))}return t}function qe(t,e,n){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&e==null||(t.__u=t(e))}else t.current=e}catch(r){b.__e(r,n)}}function zt(t,e,n){var s,r;if(b.unmount&&b.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||qe(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(i){b.__e(i,e)}s.base=s.__P=null}if(s=t.__k)for(r=0;r<s.length;r++)s[r]&&zt(s[r],e,n||typeof t.type!="function");n||He(t.__e),t.__c=t.__=t.__e=void 0}function Pn(t,e,n){return this.constructor(t,n)}function ne(t,e,n){var s,r,i,o;e==document&&(e=document.documentElement),b.__&&b.__(t,e),r=(s=typeof n=="function")?null:n&&n.__k||e.__k,i=[],o=[],Fe(e,t=(!s&&n||e).__k=M($,null,[t]),r||te,te,e.namespaceURI,!s&&n?[n]:r?null:e.firstChild?se.call(e.childNodes):null,i,!s&&n?n:r?r.__e:e.firstChild,s,o),$t(i,t,o)}function Ht(t,e){ne(t,e,Ht)}function Rn(t,e,n){var s,r,i,o,c=D({},t.props);for(i in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)i=="key"?s=e[i]:i=="ref"?r=e[i]:c[i]=e[i]===void 0&&o!=null?o[i]:e[i];return arguments.length>2&&(c.children=arguments.length>3?se.call(arguments,2):n),K(t.type,c,s||t.key,r||t.ref,null)}function On(t){function e(n){var s,r;return this.getChildContext||(s=new Set,(r={})[e.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(i){this.props.value!=i.value&&s.forEach(function(o){o.__e=!0,Ne(o)})},this.sub=function(i){s.add(i);var o=i.componentWillUnmount;i.componentWillUnmount=function(){s&&s.delete(i),o&&o.call(i)}}),n.children}return e.__c="__cC"+Ut++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,s){return n.children(s)}).contextType=e,e}se=Nt.slice,b={__e:function(t,e,n,s){for(var r,i,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((i=r.constructor)&&i.getDerivedStateFromError!=null&&(r.setState(i.getDerivedStateFromError(t)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,s||{}),o=r.__d),o)return r.__E=r}catch(c){t=c}throw t}},It=0,U.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=D({},this.state),typeof t=="function"&&(t=t(D({},n),this.props)),t&&D(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Ne(this))},U.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Ne(this))},U.prototype.render=$,q=[],xt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Lt=function(t,e){return t.__v.__b-e.__v.__b},pe.__r=0,Dt=/(PointerCapture)$|Capture$/i,ze=0,De=tt(!1),Ue=tt(!0),Ut=0;var In=0;function R(t,e,n,s,r,i){e||(e={});var o,c,u=e;if("ref"in u)for(c in u={},e)c=="ref"?o=e[c]:u[c]=e[c];var a={type:t,props:u,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--In,__i:-1,__u:0,__source:r,__self:i};if(typeof t=="function"&&(o=t.defaultProps))for(c in o)u[c]===void 0&&(u[c]=o[c]);return b.vnode&&b.vnode(a),a}var F,w,Re,nt,G=0,Ft=[],T=b,st=T.__b,rt=T.__r,it=T.diffed,ot=T.__c,ct=T.unmount,at=T.__;function Q(t,e){T.__h&&T.__h(w,t,G||e),G=0;var n=w.__H||(w.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Be(t){return G=1,Je(Qt,t)}function Je(t,e,n){var s=Q(F++,2);if(s.t=t,!s.__c&&(s.__=[n?n(e):Qt(void 0,e),function(c){var u=s.__N?s.__N[0]:s.__[0],a=s.t(u,c);u!==a&&(s.__N=[a,s.__[1]],s.__c.setState({}))}],s.__c=w,!w.__f)){var r=function(c,u,a){if(!s.__c.__H)return!0;var f=s.__c.__H.__.filter(function(d){return!!d.__c});if(f.every(function(d){return!d.__N}))return!i||i.call(this,c,u,a);var _=s.__c.props!==c;return f.forEach(function(d){if(d.__N){var l=d.__[0];d.__=d.__N,d.__N=void 0,l!==d.__[0]&&(_=!0)}}),i&&i.call(this,c,u,a)||_};w.__f=!0;var i=w.shouldComponentUpdate,o=w.componentWillUpdate;w.componentWillUpdate=function(c,u,a){if(this.__e){var f=i;i=void 0,r(c,u,a),i=f}o&&o.call(this,c,u,a)},w.shouldComponentUpdate=r}return s.__N||s.__}function ye(t,e){var n=Q(F++,3);!T.__s&&Ge(n.__H,e)&&(n.__=t,n.u=e,w.__H.__h.push(n))}function ie(t,e){var n=Q(F++,4);!T.__s&&Ge(n.__H,e)&&(n.__=t,n.u=e,w.__h.push(n))}function Ve(t){return G=5,Se(function(){return{current:t}},[])}function qt(t,e,n){G=6,ie(function(){if(typeof t=="function"){var s=t(e());return function(){t(null),s&&typeof s=="function"&&s()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function Se(t,e){var n=Q(F++,7);return Ge(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Bt(t,e){return G=8,Se(function(){return t},e)}function Jt(t){var e=w.context[t.__c],n=Q(F++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(w)),e.props.value):t.__}function Vt(t,e){T.useDebugValue&&T.useDebugValue(e?e(t):t)}function Gt(){var t=Q(F++,11);if(!t.__){for(var e=w.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function xn(){for(var t;t=Ft.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(_e),t.__H.__h.forEach(je),t.__H.__h=[]}catch(e){t.__H.__h=[],T.__e(e,t.__v)}}T.__b=function(t){w=null,st&&st(t)},T.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),at&&at(t,e)},T.__r=function(t){rt&&rt(t),F=0;var e=(w=t.__c).__H;e&&(Re===w?(e.__h=[],w.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(_e),e.__h.forEach(je),e.__h=[],F=0)),Re=w},T.diffed=function(t){it&&it(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Ft.push(e)!==1&&nt===T.requestAnimationFrame||((nt=T.requestAnimationFrame)||Ln)(xn)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Re=w=null},T.__c=function(t,e){e.some(function(n){try{n.__h.forEach(_e),n.__h=n.__h.filter(function(s){return!s.__||je(s)})}catch(s){e.some(function(r){r.__h&&(r.__h=[])}),e=[],T.__e(s,n.__v)}}),ot&&ot(t,e)},T.unmount=function(t){ct&&ct(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{_e(s)}catch(r){e=r}}),n.__H=void 0,e&&T.__e(e,n.__v))};var ut=typeof requestAnimationFrame=="function";function Ln(t){var e,n=function(){clearTimeout(s),ut&&cancelAnimationFrame(e),setTimeout(t)},s=setTimeout(n,35);ut&&(e=requestAnimationFrame(n))}function _e(t){var e=w,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),w=e}function je(t){var e=w;t.__c=t.__(),w=e}function Ge(t,e){return!t||t.length!==e.length||e.some(function(n,s){return n!==t[s]})}function Qt(t,e){return typeof e=="function"?e(t):e}function Zt(t,e){for(var n in e)t[n]=e[n];return t}function Me(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var s in e)if(s!=="__source"&&t[s]!==e[s])return!0;return!1}function Xt(t,e){var n=e(),s=Be({t:{__:n,u:e}}),r=s[0].t,i=s[1];return ie(function(){r.__=n,r.u=e,Oe(r)&&i({t:r})},[t,n,e]),ye(function(){return Oe(r)&&i({t:r}),t(function(){Oe(r)&&i({t:r})})},[t]),n}function Oe(t){var e,n,s=t.u,r=t.__;try{var i=s();return!((e=r)===(n=i)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Yt(t){t()}function Kt(t){return t}function en(){return[!1,Yt]}var tn=ie;function $e(t,e){this.props=t,this.context=e}function oe(t,e){function n(r){var i=this.props.ref,o=i==r.ref;return!o&&i&&(i.call?i(null):i.current=null),e?!e(this.props,r)||!o:Me(this.props,r)}function s(r){return this.shouldComponentUpdate=n,M(t,r)}return s.displayName="Memo("+(t.displayName||t.name)+")",s.prototype.isReactComponent=!0,s.__f=!0,s.type=t,s}($e.prototype=new U).isPureReactComponent=!0,$e.prototype.shouldComponentUpdate=function(t,e){return Me(this.props,t)||Me(this.state,e)};var lt=b.__b;b.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),lt&&lt(t)};var Dn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Un(t){function e(n){var s=Zt({},n);return delete s.ref,t(s,n.ref||null)}return e.$$typeof=Dn,e.render=t,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var _t=function(t,e){return t==null?null:j(j(t).map(e))},Nn={map:_t,forEach:_t,count:function(t){return t?j(t).length:0},only:function(t){var e=j(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:j},An=b.__e;b.__e=function(t,e,n,s){if(t.then){for(var r,i=e;i=i.__;)if((r=i.__c)&&r.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),r.__c(t,e)}An(t,e,n,s)};var ht=b.unmount;function nn(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(s){typeof s.__c=="function"&&s.__c()}),t.__c.__H=null),(t=Zt({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(s){return nn(s,e,n)})),t}function sn(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(s){return sn(s,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function he(){this.__u=0,this.o=null,this.__b=null}function rn(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function jn(t){var e,n,s;function r(i){if(e||(e=t()).then(function(o){n=o.default||o},function(o){s=o}),s)throw s;if(!n)throw e;return M(n,i)}return r.displayName="Lazy",r.__f=!0,r}function Y(){this.i=null,this.l=null}b.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),ht&&ht(t)},(he.prototype=new U).__c=function(t,e){var n=e.__c,s=this;s.o==null&&(s.o=[]),s.o.push(n);var r=rn(s.__v),i=!1,o=function(){i||(i=!0,n.__R=null,r?r(c):c())};n.__R=o;var c=function(){if(!--s.__u){if(s.state.__a){var u=s.state.__a;s.__v.__k[0]=sn(u,u.__c.__P,u.__c.__O)}var a;for(s.setState({__a:s.__b=null});a=s.o.pop();)a.forceUpdate()}};s.__u++||32&e.__u||s.setState({__a:s.__b=s.__v.__k[0]}),t.then(o,o)},he.prototype.componentWillUnmount=function(){this.o=[]},he.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),s=this.__v.__k[0].__c;this.__v.__k[0]=nn(this.__b,n,s.__O=s.__P)}this.__b=null}var r=e.__a&&M($,null,t.fallback);return r&&(r.__u&=-33),[M($,null,e.__a?null:t.children),r]};var ft=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function Mn(t){return this.getChildContext=function(){return t.context},t.children}function $n(t){var e=this,n=t.h;if(e.componentWillUnmount=function(){ne(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),!e.v){for(var s=e.__v;s!==null&&!s.__m&&s.__!==null;)s=s.__;e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:s.__m},contains:function(){return!0},insertBefore:function(r,i){this.childNodes.push(r),e.h.insertBefore(r,i)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.h.removeChild(r)}}}ne(M(Mn,{context:e.context},t.__v),e.v)}function Wn(t,e){var n=M($n,{__v:t,h:e});return n.containerInfo=e,n}(Y.prototype=new U).__a=function(t){var e=this,n=rn(e.__v),s=e.l.get(t);return s[0]++,function(r){var i=function(){e.props.revealOrder?(s.push(r),ft(e,t,s)):r()};n?n(i):i()}},Y.prototype.render=function(t){this.i=null,this.l=new Map;var e=j(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},Y.prototype.componentDidUpdate=Y.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){ft(t,n,e)})};var on=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,zn=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Hn=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Fn=/[A-Z0-9]/g,qn=typeof document<"u",Bn=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function cn(t,e,n){return e.__k==null&&(e.textContent=""),ne(t,e),typeof n=="function"&&n(),t?t.__c:null}function Jn(t,e,n){return Ht(t,e),typeof n=="function"&&n(),t?t.__c:null}U.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(U.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var dt=b.event;function Vn(){}function Gn(){return this.cancelBubble}function Qn(){return this.defaultPrevented}b.event=function(t){return dt&&(t=dt(t)),t.persist=Vn,t.isPropagationStopped=Gn,t.isDefaultPrevented=Qn,t.nativeEvent=t};var Qe,Zn={enumerable:!1,configurable:!0,get:function(){return this.class}},pt=b.vnode;b.vnode=function(t){typeof t.type=="string"&&(function(e){var n=e.props,s=e.type,r={},i=s.indexOf("-")===-1;for(var o in n){var c=n[o];if(!(o==="value"&&"defaultValue"in n&&c==null||qn&&o==="children"&&s==="noscript"||o==="class"||o==="className")){var u=o.toLowerCase();o==="defaultValue"&&"value"in n&&n.value==null?o="value":o==="download"&&c===!0?c="":u==="translate"&&c==="no"?c=!1:u[0]==="o"&&u[1]==="n"?u==="ondoubleclick"?o="ondblclick":u!=="onchange"||s!=="input"&&s!=="textarea"||Bn(n.type)?u==="onfocus"?o="onfocusin":u==="onblur"?o="onfocusout":Hn.test(o)&&(o=u):u=o="oninput":i&&zn.test(o)?o=o.replace(Fn,"-$&").toLowerCase():c===null&&(c=void 0),u==="oninput"&&r[o=u]&&(o="oninputCapture"),r[o]=c}}s=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=j(n.children).forEach(function(a){a.props.selected=r.value.indexOf(a.props.value)!=-1})),s=="select"&&r.defaultValue!=null&&(r.value=j(n.children).forEach(function(a){a.props.selected=r.multiple?r.defaultValue.indexOf(a.props.value)!=-1:r.defaultValue==a.props.value})),n.class&&!n.className?(r.class=n.class,Object.defineProperty(r,"className",Zn)):(n.className&&!n.class||n.class&&n.className)&&(r.class=r.className=n.className),e.props=r})(t),t.$$typeof=on,pt&&pt(t)};var mt=b.__r;b.__r=function(t){mt&&mt(t),Qe=t.__c};var bt=b.diffed;b.diffed=function(t){bt&&bt(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),Qe=null};var Xn={ReactCurrentDispatcher:{current:{readContext:function(t){return Qe.__n[t.__c].props.value},useCallback:Bt,useContext:Jt,useDebugValue:Vt,useDeferredValue:Kt,useEffect:ye,useId:Gt,useImperativeHandle:qt,useInsertionEffect:tn,useLayoutEffect:ie,useMemo:Se,useReducer:Je,useRef:Ve,useState:Be,useSyncExternalStore:Xt,useTransition:en}}};function Yn(t){return M.bind(null,t)}function we(t){return!!t&&t.$$typeof===on}function Kn(t){return we(t)&&t.type===$}function es(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function ts(t){return we(t)?Rn.apply(null,arguments):t}function an(t){return!!t.__k&&(ne(null,t),!0)}function ns(t){return t&&(t.base||t.nodeType===1&&t)||null}var ss=function(t,e){return t(e)},rs=function(t,e){return t(e)},is=$,os=we,le={useState:Be,useId:Gt,useReducer:Je,useEffect:ye,useLayoutEffect:ie,useInsertionEffect:tn,useTransition:en,useDeferredValue:Kt,useSyncExternalStore:Xt,startTransition:Yt,useRef:Ve,useImperativeHandle:qt,useMemo:Se,useCallback:Bt,useContext:Jt,useDebugValue:Vt,version:"18.3.1",Children:Nn,render:cn,hydrate:Jn,unmountComponentAtNode:an,createPortal:Wn,createElement:M,createContext:On,createFactory:Yn,cloneElement:ts,createRef:kn,Fragment:$,isValidElement:we,isElement:os,isFragment:Kn,isMemo:es,findDOMNode:ns,Component:U,PureComponent:$e,memo:oe,forwardRef:Un,flushSync:rs,unstable_batchedUpdates:ss,StrictMode:is,Suspense:he,SuspenseList:Y,lazy:jn,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Xn};const gt=t=>{let e;const n=new Set,s=(a,f)=>{const _=typeof a=="function"?a(e):a;if(!Object.is(_,e)){const d=e;e=f??(typeof _!="object"||_===null)?_:Object.assign({},e,_),n.forEach(l=>l(e,d))}},r=()=>e,c={setState:s,getState:r,getInitialState:()=>u,subscribe:a=>(n.add(a),()=>n.delete(a))},u=e=t(s,r,c);return c},cs=t=>t?gt(t):gt,as=t=>t;function us(t,e=as){const n=le.useSyncExternalStore(t.subscribe,le.useCallback(()=>e(t.getState()),[t,e]),le.useCallback(()=>e(t.getInitialState()),[t,e]));return le.useDebugValue(n),n}const vt=t=>{const e=cs(t),n=s=>us(e,s);return Object.assign(n,e),n},un=t=>t?vt(t):vt;var P=(t=>(t.desktopStreamTrack="desktopStreamTrack",t.cameraStreamTrack="cameraStreamTrack",t.microphoneStreamTrack="microphoneStreamTrack",t))(P||{}),x=(t=>(t.HIGH="HIGH",t.MEDIUM="MEDIUM",t.LOW="LOW",t))(x||{});const ls={[x.HIGH]:30,[x.MEDIUM]:20,[x.LOW]:10},yt=t=>({facingMode:"user",frameRate:{max:ls[t]}}),St=t=>!0,_s={[x.HIGH]:1024,[x.MEDIUM]:512,[x.LOW]:256},hs={[x.HIGH]:30,[x.MEDIUM]:20,[x.LOW]:10},wt=t=>({facingMode:"user",width:{ideal:_s[t]},frameRate:{max:hs[t]}}),ke=un((t,e)=>{let n;async function s(o,c){o&&await o.applyConstraints(c)}function r(...o){const c={};o.forEach(u=>{const a=e()[u];a&&(a.stop(),c[u]=null,n.setEnabled(u,!1))}),t(c)}function i(o,c){t({[c]:o}),n.setEnabled(c,!!o)}return{quality:x.LOW,async setQuality(o){const{cameraStreamTrack:c,desktopStreamTrack:u,microphoneStreamTrack:a}=e();await s(c,wt(o)),await s(u,yt(o)),await s(a,St()),t({quality:o}),n?.setQuality(o)},async startCameraStream(){try{const o=await navigator.mediaDevices.getUserMedia({audio:!1,video:wt(e().quality)});i(o.getTracks()[0],P.cameraStreamTrack)}catch{n.setEnabled(P.cameraStreamTrack,!1)}},async stopCameraStream(){r(P.cameraStreamTrack)},async startDesktopStream(){try{const o=await navigator.mediaDevices.getDisplayMedia({audio:!1,video:yt(e().quality)});i(o.getTracks()[0],P.desktopStreamTrack)}catch{n.setEnabled(P.desktopStreamTrack,!1)}},async stopDesktopStream(){r(P.desktopStreamTrack)},async startMicrophoneStream(){try{const o=await navigator.mediaDevices.getUserMedia({video:!1,audio:St(e().quality)});i(o.getTracks()[0],P.microphoneStreamTrack)}catch{n.setEnabled(P.microphoneStreamTrack,!1)}},async stopMicrophoneStream(){r(P.microphoneStreamTrack)},stop(){r(P.cameraStreamTrack,P.microphoneStreamTrack,P.microphoneStreamTrack)},getActualTracks(o){const c=[],{desktopStreamTrack:u,cameraStreamTrack:a,microphoneStreamTrack:f}=e();return u?c.push(u):a&&c.push(a),!o&&f&&c.push(f),c},async restore(o){n=o,t({quality:o.getQuality()}),n.isEnabled(P.cameraStreamTrack)&&await e().startCameraStream(),n.isEnabled(P.microphoneStreamTrack)&&await e().startMicrophoneStream(),n.isEnabled(P.desktopStreamTrack)&&await e().startDesktopStream()}}});function Te(t){const e=t?.prefix,n=e&&t?.color;return(...s)=>{t.disabled||(document.querySelector("#log").innerHTML+="<pre style='margin: 0'>"+fs(e,n)+" "+s.map(ds).join(" ")+`
</pre>`,n&&s.unshift("background-color: "+n),e&&s.unshift((n?"%c":"")+e),console.log(...s))}}function fs(t,e){return`<span style="background-color: ${e}">${t}</span>`}function ds(t){if(typeof t=="object")return`<details><summary>${t}</summary>${JSON.stringify(t,null,2)}</details>`;let e=t.split("-");return e.length>3?e[0]:t}const ps=Te({prefix:"[createConnection]",color:"#ded"});function ms(t,e){const n={iceRestart:!0,offerToReceiveAudio:!0,offerToReceiveVideo:!0},s=new RTCPeerConnection(window.cfg);return s.oniceconnectionstatechange=()=>{s.iceConnectionState==="failed"&&s.restartIce()},{innerState:{peerConnection:s,localUserId:t,remoteUserId:e},async createOffer(){const i=await s.createOffer(n);return await s.setLocalDescription(new RTCSessionDescription(i)),s.localDescription},async receiveOffer(i){await s.setRemoteDescription(i);const o=await s.createAnswer(n);return await s.setLocalDescription(new RTCSessionDescription(o)),s.localDescription},async receiveAnswer(i){await s.setRemoteDescription(i)},async disconnect(){await s.close()},async iceCandidate(i){ps("processing ice candidate"),await s.addIceCandidate(i)},updateTracks(i){i.forEach(o=>s.addTrack(o))}}}function bs(t,e){return kt(t)<kt(e)}function kt(t){let e,n=new Uint32Array([1,2,3,4].map(s=>parseInt(t.substr(s*8,8),16)));return e=n[3],n[3]=n[2],n[2]=n[1],n[1]=n[0],e^=e<<11,e^=e>>>8,n[0]=e^n[0]^n[0]>>>19,n[0]/4294967296}function gs(t){return{userId:t,tracks:[],progress:0,iceCandidates:[],status:""}}const We=Te({prefix:"[processIceCandidate]",color:"#edd"});async function vs(t,e){We("received ice candidate"),t.connection&&t.connection.innerState.peerConnection.remoteDescription?await t.connection.iceCandidate(e):(We("queuing ice candidate"),t.iceCandidates.push(e))}function Tt(t){t.iceCandidates.length&&(We("processing ice candidates queue"),t.iceCandidates.forEach(t.connection.iceCandidate),t.iceCandidates.splice(0,t.iceCandidates.length))}const I=Te({prefix:"[createConference]",color:"#dde"});function ys(){const t={currentUserId:null,signalling:null,otherUsers:[]};function e(l,h){return{from:t.currentUserId,to:l.userId,payload:h}}function n(l){return h=>{const m=t.otherUsers.find(p=>p.userId===h.from);m&&l(m,h.payload)}}async function s(l){const h=l.filter(m=>m!==t.currentUserId);await _(i(h)),await f(r(h))}function r(l){return t.otherUsers.filter(h=>!l.includes(h.userId))}function i(l){const h=t.otherUsers.map(m=>m.userId);return l.filter(m=>!h.includes(m)).map(gs)}async function o(l){await new Promise(m=>setTimeout(m,300));const h=await l.connection.createOffer();I("send offer to:",l.userId),await t.signalling.offer.emit(e(l,h))}async function c(l,h){I("received OFFER from:",l.userId),await d(l);const m=await l.connection.receiveOffer(h);I("send ANSWER to:",l.userId),await t.signalling.answer.emit(e(l,m)),Tt(l)}async function u(l,h){I("received ANSWER from:",l.userId),await l.connection.receiveAnswer(h),Tt(l)}const a={onChange:null,onJoin:null,onLeft:null,async connect(l,h){I("connect, currentUserId:",l),t.currentUserId=l,t.signalling=h,h.setUserIdList=s,h.offer.on(n(c)),h.answer.on(n(u)),h.iceCandidate.on(n(vs)),await h.connect()},async disconnect(){await t.signalling.off(),await f(t.otherUsers)},updateTracks(l){I("updateTracks:",l),t.otherUsers.forEach(h=>h.connection.updateTracks(l))}};async function f(l){for(const h of l)I("user left:",h.userId),await h.connection.disconnect(),t.otherUsers.splice(t.otherUsers.indexOf(h),1);l.length&&await a.onLeft(l)}async function _(l){for(const h of l)I("user joined:",h.userId),t.otherUsers.push(h),bs(t.currentUserId,h.userId)&&(await d(h),await o(h));l.length&&await a.onJoin(l)}async function d(l,h){if(l.connection)return;I("createConnection:",t.currentUserId,"->",l.userId),l.connection=ms(t.currentUserId,l.userId);const m=ke.getState().getActualTracks();I("setupTracks",m),l.connection.updateTracks(m);const p=l.connection.innerState.peerConnection;p.onicecandidate=async g=>{I("sending ice candidate"),await t.signalling.iceCandidate.emit(e(l,g.candidate))},p.onconnectionstatechange=g=>{let v=p.connectionState;I("connection state with:",l.userId,v),l.status=v,v==="connected"&&!p.onnegotiationneeded&&(p.onnegotiationneeded=async N=>{I("negotiation needed with:",l.userId),await o(l)}),a.onChange([l])},p.ontrack=g=>{I("tracks changed:",l.userId,g),l.tracks.push(g.track),a.onChange([l])}}return a}class Ie{}const k={log:!1,socket:null,socketId:null,connected:!1,taskQueue:[],listeners:new Map,emitters:new Map};function Ss(t,e){return Object.entries(t).forEach(n=>{n[1].eventName=n[0],n[1].transform=e}),t}function H(...t){k.log&&console.log(...t)}function O(t,e,n,s){function r(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function c(f){try{a(s.next(f))}catch(_){o(_)}}function u(f){try{a(s.throw(f))}catch(_){o(_)}}function a(f){f.done?i(f.value):r(f.value).then(c,u)}a((s=s.apply(t,[])).next())})}function ws(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ze={exports:{}},J=typeof Reflect=="object"?Reflect:null,Et=J&&typeof J.apply=="function"?J.apply:function(e,n,s){return Function.prototype.apply.call(e,n,s)},fe;J&&typeof J.ownKeys=="function"?fe=J.ownKeys:Object.getOwnPropertySymbols?fe=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:fe=function(e){return Object.getOwnPropertyNames(e)};function ks(t){console&&console.warn&&console.warn(t)}var ln=Number.isNaN||function(e){return e!==e};function y(){y.init.call(this)}Ze.exports=y;Ze.exports.once=Ps;y.EventEmitter=y;y.prototype._events=void 0;y.prototype._eventsCount=0;y.prototype._maxListeners=void 0;var Ct=10;function Ee(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return Ct},set:function(t){if(typeof t!="number"||t<0||ln(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Ct=t}});y.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};y.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ln(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _n(t){return t._maxListeners===void 0?y.defaultMaxListeners:t._maxListeners}y.prototype.getMaxListeners=function(){return _n(this)};y.prototype.emit=function(e){for(var n=[],s=1;s<arguments.length;s++)n.push(arguments[s]);var r=e==="error",i=this._events;if(i!==void 0)r=r&&i.error===void 0;else if(!r)return!1;if(r){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var u=i[e];if(u===void 0)return!1;if(typeof u=="function")Et(u,this,n);else for(var a=u.length,f=mn(u,a),s=0;s<a;++s)Et(f[s],this,n);return!0};function hn(t,e,n,s){var r,i,o;if(Ee(n),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),o=i[e]),o===void 0)o=i[e]=n,++t._eventsCount;else if(typeof o=="function"?o=i[e]=s?[n,o]:[o,n]:s?o.unshift(n):o.push(n),r=_n(t),r>0&&o.length>r&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,ks(c)}return t}y.prototype.addListener=function(e,n){return hn(this,e,n,!1)};y.prototype.on=y.prototype.addListener;y.prototype.prependListener=function(e,n){return hn(this,e,n,!0)};function Ts(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function fn(t,e,n){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=Ts.bind(s);return r.listener=n,s.wrapFn=r,r}y.prototype.once=function(e,n){return Ee(n),this.on(e,fn(this,e,n)),this};y.prototype.prependOnceListener=function(e,n){return Ee(n),this.prependListener(e,fn(this,e,n)),this};y.prototype.removeListener=function(e,n){var s,r,i,o,c;if(Ee(n),r=this._events,r===void 0)return this;if(s=r[e],s===void 0)return this;if(s===n||s.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,s.listener||n));else if(typeof s!="function"){for(i=-1,o=s.length-1;o>=0;o--)if(s[o]===n||s[o].listener===n){c=s[o].listener,i=o;break}if(i<0)return this;i===0?s.shift():Es(s,i),s.length===1&&(r[e]=s[0]),r.removeListener!==void 0&&this.emit("removeListener",e,c||n)}return this};y.prototype.off=y.prototype.removeListener;y.prototype.removeAllListeners=function(e){var n,s,r;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var i=Object.keys(s),o;for(r=0;r<i.length;++r)o=i[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=s[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(r=n.length-1;r>=0;r--)this.removeListener(e,n[r]);return this};function dn(t,e,n){var s=t._events;if(s===void 0)return[];var r=s[e];return r===void 0?[]:typeof r=="function"?n?[r.listener||r]:[r]:n?Cs(r):mn(r,r.length)}y.prototype.listeners=function(e){return dn(this,e,!0)};y.prototype.rawListeners=function(e){return dn(this,e,!1)};y.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):pn.call(t,e)};y.prototype.listenerCount=pn;function pn(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}y.prototype.eventNames=function(){return this._eventsCount>0?fe(this._events):[]};function mn(t,e){for(var n=new Array(e),s=0;s<e;++s)n[s]=t[s];return n}function Es(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Cs(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Ps(t,e){return new Promise(function(n,s){function r(o){t.removeListener(e,i),s(o)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",r),n([].slice.call(arguments))}bn(t,e,i,{once:!0}),e!=="error"&&Rs(t,r,{once:!0})})}function Rs(t,e,n){typeof t.on=="function"&&bn(t,"error",e,n)}function bn(t,e,n,s){if(typeof t.on=="function")s.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function r(i){s.once&&t.removeEventListener(e,r),n(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Os=Ze.exports,gn=ws(Os),S;(function(t){t[t.timeout=1]="timeout",t[t.transportClosed=2]="transportClosed",t[t.clientDisconnected=3]="clientDisconnected",t[t.clientClosed=4]="clientClosed",t[t.clientConnectToken=5]="clientConnectToken",t[t.clientRefreshToken=6]="clientRefreshToken",t[t.subscriptionUnsubscribed=7]="subscriptionUnsubscribed",t[t.subscriptionSubscribeToken=8]="subscriptionSubscribeToken",t[t.subscriptionRefreshToken=9]="subscriptionRefreshToken",t[t.transportWriteError=10]="transportWriteError",t[t.connectionClosed=11]="connectionClosed",t[t.badConfiguration=12]="badConfiguration"})(S||(S={}));var z;(function(t){t[t.connectCalled=0]="connectCalled",t[t.transportClosed=1]="transportClosed",t[t.noPing=2]="noPing",t[t.subscribeTimeout=3]="subscribeTimeout",t[t.unsubscribeError=4]="unsubscribeError"})(z||(z={}));var ee;(function(t){t[t.disconnectCalled=0]="disconnectCalled",t[t.unauthorized=1]="unauthorized",t[t.badProtocol=2]="badProtocol",t[t.messageSizeLimit=3]="messageSizeLimit"})(ee||(ee={}));var me;(function(t){t[t.subscribeCalled=0]="subscribeCalled",t[t.transportClosed=1]="transportClosed"})(me||(me={}));var be;(function(t){t[t.unsubscribeCalled=0]="unsubscribeCalled",t[t.unauthorized=1]="unauthorized",t[t.clientClosed=2]="clientClosed"})(be||(be={}));var E;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected"})(E||(E={}));var C;(function(t){t.Unsubscribed="unsubscribed",t.Subscribing="subscribing",t.Subscribed="subscribed"})(C||(C={}));function Is(t,e){return t.lastIndexOf(e,0)===0}function vn(t){return t==null?!1:typeof t=="function"}function xs(t,e){if(globalThis.console){const n=globalThis.console[t];vn(n)&&n.apply(globalThis.console,e)}}function Ls(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function ge(t,e,n){t>31&&(t=31);const s=Ls(0,Math.min(n,e*Math.pow(2,t)));return Math.min(n,e+s)}function Ds(t){return"error"in t&&t.error!==null}function ve(t){return Math.min(t*1e3,2147483647)}class Us extends gn{constructor(e,n,s){super(),this._resubscribeTimeout=null,this._refreshTimeout=null,this.channel=n,this.state=C.Unsubscribed,this._centrifuge=e,this._token="",this._getToken=null,this._data=null,this._getData=null,this._recover=!1,this._offset=null,this._epoch=null,this._recoverable=!1,this._positioned=!1,this._joinLeave=!1,this._minResubscribeDelay=500,this._maxResubscribeDelay=2e4,this._resubscribeTimeout=null,this._resubscribeAttempts=0,this._promises={},this._promiseId=0,this._inflight=!1,this._refreshTimeout=null,this._delta="",this._delta_negotiated=!1,this._prevValue=null,this._unsubPromise=Promise.resolve(),this._setOptions(s),this._centrifuge._debugEnabled?(this.on("state",r=>{this._debug("subscription state",n,r.oldState,"->",r.newState)}),this.on("error",r=>{this._debug("subscription error",n,r)})):this.on("error",function(){Function.prototype()})}ready(e){return this.state===C.Unsubscribed?Promise.reject({code:S.subscriptionUnsubscribed,message:this.state}):this.state===C.Subscribed?Promise.resolve():new Promise((n,s)=>{const r={resolve:n,reject:s};e&&(r.timeout=setTimeout(function(){s({code:S.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=r})}subscribe(){this._isSubscribed()||(this._resubscribeAttempts=0,this._setSubscribing(me.subscribeCalled,"subscribe called"))}unsubscribe(){this._unsubPromise=this._setUnsubscribed(be.unsubscribeCalled,"unsubscribe called",!0)}publish(e){return O(this,void 0,void 0,function*(){return yield this._methodCall(),this._centrifuge.publish(this.channel,e)})}presence(){return O(this,void 0,void 0,function*(){return yield this._methodCall(),this._centrifuge.presence(this.channel)})}presenceStats(){return O(this,void 0,void 0,function*(){return yield this._methodCall(),this._centrifuge.presenceStats(this.channel)})}history(e){return O(this,void 0,void 0,function*(){return yield this._methodCall(),this._centrifuge.history(this.channel,e)})}_methodCall(){return this._isSubscribed()?Promise.resolve():this._isUnsubscribed()?Promise.reject({code:S.subscriptionUnsubscribed,message:this.state}):new Promise((e,n)=>{const s=this._centrifuge._config.timeout,r=setTimeout(()=>{n({code:S.timeout,message:"timeout"})},s);this._promises[this._nextPromiseId()]={timeout:r,resolve:e,reject:n}})}_nextPromiseId(){return++this._promiseId}_needRecover(){return this._recover===!0}_isUnsubscribed(){return this.state===C.Unsubscribed}_isSubscribing(){return this.state===C.Subscribing}_isSubscribed(){return this.state===C.Subscribed}_setState(e){if(this.state!==e){const n=this.state;return this.state=e,this.emit("state",{newState:e,oldState:n,channel:this.channel}),!0}return!1}_usesToken(){return this._token!==""||this._getToken!==null}_clearSubscribingState(){this._resubscribeAttempts=0,this._clearResubscribeTimeout()}_clearSubscribedState(){this._clearRefreshTimeout()}_setSubscribed(e){if(!this._isSubscribing())return;this._clearSubscribingState(),e.recoverable&&(this._recover=!0,this._offset=e.offset||0,this._epoch=e.epoch||""),e.delta?this._delta_negotiated=!0:this._delta_negotiated=!1,this._setState(C.Subscribed);const n=this._centrifuge._getSubscribeContext(this.channel,e);this.emit("subscribed",n),this._resolvePromises();const s=e.publications;if(s&&s.length>0)for(const r in s)s.hasOwnProperty(r)&&this._handlePublication(s[r]);e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),ve(e.ttl)))}_setSubscribing(e,n){return O(this,void 0,void 0,function*(){this._isSubscribing()||(this._isSubscribed()&&this._clearSubscribedState(),this._setState(C.Subscribing)&&this.emit("subscribing",{channel:this.channel,code:e,reason:n}),this._centrifuge._transport&&this._centrifuge._transport.emulation()&&(yield this._unsubPromise),this._isSubscribing()&&this._subscribe())})}_subscribe(){return this._debug("subscribing on",this.channel),this._isTransportOpen()?this._inflight?null:(this._inflight=!0,this._canSubscribeWithoutGettingToken()?this._subscribeWithoutToken():(this._getSubscriptionToken().then(e=>this._handleTokenResponse(e)).catch(e=>this._handleTokenError(e)),null)):(this._debug("delay subscribe on",this.channel,"till connected"),null)}_isTransportOpen(){return this._centrifuge._transportIsOpen}_canSubscribeWithoutGettingToken(){return!this._usesToken()||!!this._token}_subscribeWithoutToken(){return this._getData?(this._getDataAndSubscribe(this._token),null):this._sendSubscribe(this._token)}_getDataAndSubscribe(e){if(!this._getData){this._inflight=!1;return}this._getData({channel:this.channel}).then(n=>{if(!this._isSubscribing()){this._inflight=!1;return}this._data=n,this._sendSubscribe(e)}).catch(n=>this._handleGetDataError(n))}_handleGetDataError(e){if(!this._isSubscribing()){this._inflight=!1;return}if(e instanceof A){this._inflight=!1,this._failUnauthorized();return}this.emit("error",{type:"subscribeData",channel:this.channel,error:{code:S.badConfiguration,message:e?.toString()||""}}),this._inflight=!1,this._scheduleResubscribe()}_handleTokenResponse(e){if(!this._isSubscribing()){this._inflight=!1;return}if(!e){this._inflight=!1,this._failUnauthorized();return}this._token=e,this._getData?this._getDataAndSubscribe(e):this._sendSubscribe(e)}_handleTokenError(e){if(!this._isSubscribing()){this._inflight=!1;return}if(e instanceof A){this._inflight=!1,this._failUnauthorized();return}this.emit("error",{type:"subscribeToken",channel:this.channel,error:{code:S.subscriptionSubscribeToken,message:e?.toString()||""}}),this._inflight=!1,this._scheduleResubscribe()}_sendSubscribe(e){if(!this._isTransportOpen())return this._inflight=!1,null;const n=this._buildSubscribeCommand(e);return this._centrifuge._call(n).then(s=>{this._inflight=!1;const r=s.reply.subscribe;this._handleSubscribeResponse(r),s.next&&s.next()},s=>{this._inflight=!1,this._handleSubscribeError(s.error),s.next&&s.next()}),n}_buildSubscribeCommand(e){const n={channel:this.channel};if(e&&(n.token=e),this._data&&(n.data=this._data),this._positioned&&(n.positioned=!0),this._recoverable&&(n.recoverable=!0),this._joinLeave&&(n.join_leave=!0),this._needRecover()){n.recover=!0;const s=this._getOffset();s&&(n.offset=s);const r=this._getEpoch();r&&(n.epoch=r)}return this._delta&&(n.delta=this._delta),{subscribe:n}}_debug(...e){this._centrifuge._debug(...e)}_handleSubscribeError(e){if(this._isSubscribing()){if(e.code===S.timeout){this._centrifuge._disconnect(z.subscribeTimeout,"subscribe timeout",!0);return}this._subscribeError(e)}}_handleSubscribeResponse(e){this._isSubscribing()&&this._setSubscribed(e)}_setUnsubscribed(e,n,s){if(this._isUnsubscribed())return Promise.resolve();let r=Promise.resolve();return this._isSubscribed()?(s&&(r=this._centrifuge._unsubscribe(this)),this._clearSubscribedState()):this._isSubscribing()&&(this._inflight&&s&&(r=this._centrifuge._unsubscribe(this)),this._clearSubscribingState()),this._inflight=!1,this._setState(C.Unsubscribed)&&this.emit("unsubscribed",{channel:this.channel,code:e,reason:n}),this._rejectPromises({code:S.subscriptionUnsubscribed,message:this.state}),r}_handlePublication(e){if(this._delta&&this._delta_negotiated){const{newData:s,newPrevValue:r}=this._centrifuge._codec.applyDeltaIfNeeded(e,this._prevValue);e.data=s,this._prevValue=r}const n=this._centrifuge._getPublicationContext(this.channel,e);this.emit("publication",n),e.offset&&(this._offset=e.offset)}_handleJoin(e){const n=this._centrifuge._getJoinLeaveContext(e.info);this.emit("join",{channel:this.channel,info:n})}_handleLeave(e){const n=this._centrifuge._getJoinLeaveContext(e.info);this.emit("leave",{channel:this.channel,info:n})}_resolvePromises(){for(const e in this._promises)this._promises.hasOwnProperty(e)&&(this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e])}_rejectPromises(e){for(const n in this._promises)this._promises.hasOwnProperty(n)&&(this._promises[n].timeout&&clearTimeout(this._promises[n].timeout),this._promises[n].reject(e),delete this._promises[n])}_scheduleResubscribe(){if(!this._isSubscribing()){this._debug("not in subscribing state, skip resubscribe scheduling",this.channel);return}const e=this,n=this._getResubscribeDelay();this._resubscribeTimeout=setTimeout(function(){e._isSubscribing()&&e._subscribe()},n),this._debug("resubscribe scheduled after "+n,this.channel)}_subscribeError(e){if(this._isSubscribing())if(e.code<100||e.code===109||e.temporary===!0){e.code===109&&(this._token="");const n={channel:this.channel,type:"subscribe",error:e};this._centrifuge.state===E.Connected&&this.emit("error",n),this._scheduleResubscribe()}else this._setUnsubscribed(e.code,e.message,!1)}_getResubscribeDelay(){const e=ge(this._resubscribeAttempts,this._minResubscribeDelay,this._maxResubscribeDelay);return this._resubscribeAttempts++,e}_setOptions(e){if(e&&(e.since&&(this._offset=e.since.offset||0,this._epoch=e.since.epoch||"",this._recover=!0),e.data&&(this._data=e.data),e.getData&&(this._getData=e.getData),e.minResubscribeDelay!==void 0&&(this._minResubscribeDelay=e.minResubscribeDelay),e.maxResubscribeDelay!==void 0&&(this._maxResubscribeDelay=e.maxResubscribeDelay),e.token&&(this._token=e.token),e.getToken&&(this._getToken=e.getToken),e.positioned===!0&&(this._positioned=!0),e.recoverable===!0&&(this._recoverable=!0),e.joinLeave===!0&&(this._joinLeave=!0),e.delta)){if(e.delta!=="fossil")throw new Error("unsupported delta format");this._delta=e.delta}}_getOffset(){const e=this._offset;return e!==null?e:0}_getEpoch(){const e=this._epoch;return e!==null?e:""}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearResubscribeTimeout(){this._resubscribeTimeout!==null&&(clearTimeout(this._resubscribeTimeout),this._resubscribeTimeout=null)}_getSubscriptionToken(){this._debug("get subscription token for channel",this.channel);const e={channel:this.channel},n=this._getToken;return n===null?(this.emit("error",{type:"configuration",channel:this.channel,error:{code:S.badConfiguration,message:"provide a function to get channel subscription token"}}),Promise.reject(new A(""))):n(e)}_refresh(){this._clearRefreshTimeout();const e=this;this._getSubscriptionToken().then(function(n){if(!e._isSubscribed())return;if(!n){e._failUnauthorized();return}e._token=n;const r={sub_refresh:{channel:e.channel,token:n}};e._centrifuge._call(r).then(i=>{const o=i.reply.sub_refresh;e._refreshResponse(o),i.next&&i.next()},i=>{e._refreshError(i.error),i.next&&i.next()})}).catch(function(n){if(n instanceof A){e._failUnauthorized();return}e.emit("error",{type:"refreshToken",channel:e.channel,error:{code:S.subscriptionRefreshToken,message:n!==void 0?n.toString():""}}),e._refreshTimeout=setTimeout(()=>e._refresh(),e._getRefreshRetryDelay())})}_refreshResponse(e){this._isSubscribed()&&(this._debug("subscription token refreshed, channel",this.channel),this._clearRefreshTimeout(),e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),ve(e.ttl))))}_refreshError(e){this._isSubscribed()&&(e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",channel:this.channel,error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._setUnsubscribed(e.code,e.message,!0))}_getRefreshRetryDelay(){return ge(0,1e4,2e4)}_failUnauthorized(){this._setUnsubscribed(be.unauthorized,"unauthorized",!0)}}class Ns{constructor(e,n){this.endpoint=e,this.options=n,this._transport=null}name(){return"sockjs"}subName(){return"sockjs-"+this._transport.transport}emulation(){return!1}supported(){return this.options.sockjs!==null}initialize(e,n){this._transport=new this.options.sockjs(this.endpoint,null,this.options.sockjsOptions),this._transport.onopen=()=>{n.onOpen()},this._transport.onerror=s=>{n.onError(s)},this._transport.onclose=s=>{n.onClose(s)},this._transport.onmessage=s=>{n.onMessage(s.data)}}close(){this._transport.close()}send(e){this._transport.send(e)}}class Pt{constructor(e,n){this.endpoint=e,this.options=n,this._transport=null}name(){return"websocket"}subName(){return"websocket"}emulation(){return!1}supported(){return this.options.websocket!==void 0&&this.options.websocket!==null}initialize(e,n){let s="";e==="protobuf"&&(s="centrifuge-protobuf"),s!==""?this._transport=new this.options.websocket(this.endpoint,s):this._transport=new this.options.websocket(this.endpoint),e==="protobuf"&&(this._transport.binaryType="arraybuffer"),this._transport.onopen=()=>{n.onOpen()},this._transport.onerror=r=>{n.onError(r)},this._transport.onclose=r=>{n.onClose(r)},this._transport.onmessage=r=>{n.onMessage(r.data)}}close(){this._transport.close()}send(e){this._transport.send(e)}}class As{constructor(e,n){this.endpoint=e,this.options=n,this._abortController=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"http_stream"}subName(){return"http_stream"}emulation(){return!0}_handleErrors(e){if(!e.ok)throw new Error(e.status);return e}_fetchEventTarget(e,n,s){const r=new EventTarget,i=e.options.fetch;return i(n,s).then(e._handleErrors).then(o=>{r.dispatchEvent(new Event("open"));let c="",u=0,a=new Uint8Array;const f=o.body.getReader();return new e.options.readableStream({start(_){function d(){return f.read().then(({done:l,value:h})=>{if(l){r.dispatchEvent(new Event("close")),_.close();return}try{if(e._protocol==="json")for(c+=e._utf8decoder.decode(h);u<c.length;)if(c[u]===`
`){const m=c.substring(0,u);r.dispatchEvent(new MessageEvent("message",{data:m})),c=c.substring(u+1),u=0}else++u;else{const m=new Uint8Array(a.length+h.length);for(m.set(a),m.set(h,a.length),a=m;;){const p=e.options.decoder.decodeReply(a);if(p.ok){const g=a.slice(0,p.pos);r.dispatchEvent(new MessageEvent("message",{data:g})),a=a.slice(p.pos);continue}break}}}catch(m){r.dispatchEvent(new Event("error",{detail:m})),r.dispatchEvent(new Event("close")),_.close();return}d()}).catch(function(l){r.dispatchEvent(new Event("error",{detail:l})),r.dispatchEvent(new Event("close")),_.close()})}return d()}})}).catch(o=>{r.dispatchEvent(new Event("error",{detail:o})),r.dispatchEvent(new Event("close"))}),r}supported(){return this.options.fetch!==null&&this.options.readableStream!==null&&typeof TextDecoder<"u"&&typeof AbortController<"u"&&typeof EventTarget<"u"&&typeof Event<"u"&&typeof MessageEvent<"u"&&typeof Error<"u"}initialize(e,n,s){this._protocol=e,this._abortController=new AbortController;let r,i;e==="json"?(r={Accept:"application/json","Content-Type":"application/json"},i=s):(r={Accept:"application/octet-stream","Content-Type":"application/octet-stream"},i=s);const o={method:"POST",headers:r,body:i,mode:"cors",credentials:"same-origin",signal:this._abortController.signal},c=this._fetchEventTarget(this,this.endpoint,o);c.addEventListener("open",()=>{n.onOpen()}),c.addEventListener("error",u=>{this._abortController.abort(),n.onError(u)}),c.addEventListener("close",()=>{this._abortController.abort(),n.onClose({code:4,reason:"connection closed"})}),c.addEventListener("message",u=>{n.onMessage(u.data)})}close(){this._abortController.abort()}send(e,n,s){let r,i;const o={session:n,node:s,data:e};this._protocol==="json"?(r={"Content-Type":"application/json"},i=JSON.stringify(o)):(r={"Content-Type":"application/octet-stream"},i=this.options.encoder.encodeEmulationRequest(o));const c=this.options.fetch,u={method:"POST",headers:r,body:i,mode:"cors",credentials:"same-origin"};c(this.options.emulationEndpoint,u)}}class js{constructor(e,n){this.endpoint=e,this.options=n,this._protocol="json",this._transport=null,this._onClose=null}name(){return"sse"}subName(){return"sse"}emulation(){return!0}supported(){return this.options.eventsource!==null&&this.options.fetch!==null}initialize(e,n,s){let r;globalThis&&globalThis.document&&globalThis.document.baseURI?r=new URL(this.endpoint,globalThis.document.baseURI):r=new URL(this.endpoint),r.searchParams.append("cf_connect",s);const i={},o=new this.options.eventsource(r.toString(),i);this._transport=o;const c=this;o.onopen=function(){n.onOpen()},o.onerror=function(u){o.close(),n.onError(u),n.onClose({code:4,reason:"connection closed"})},o.onmessage=function(u){n.onMessage(u.data)},c._onClose=function(){n.onClose({code:4,reason:"connection closed"})}}close(){this._transport.close(),this._onClose!==null&&this._onClose()}send(e,n,s){const r={session:n,node:s,data:e},i={"Content-Type":"application/json"},o=JSON.stringify(r),c=this.options.fetch,u={method:"POST",headers:i,body:o,mode:"cors",credentials:"same-origin"};c(this.options.emulationEndpoint,u)}}class Ms{constructor(e,n){this.endpoint=e,this.options=n,this._transport=null,this._stream=null,this._writer=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"webtransport"}subName(){return"webtransport"}emulation(){return!1}supported(){return this.options.webtransport!==void 0&&this.options.webtransport!==null}initialize(e,n){return O(this,void 0,void 0,function*(){let s;globalThis&&globalThis.document&&globalThis.document.baseURI?s=new URL(this.endpoint,globalThis.document.baseURI):s=new URL(this.endpoint),e==="protobuf"&&s.searchParams.append("cf_protocol","protobuf"),this._protocol=e;const r=new EventTarget;this._transport=new this.options.webtransport(s.toString()),this._transport.closed.then(()=>{n.onClose({code:4,reason:"connection closed"})}).catch(()=>{n.onClose({code:4,reason:"connection closed"})});try{yield this._transport.ready}catch{this.close();return}let i;try{i=yield this._transport.createBidirectionalStream()}catch{this.close();return}this._stream=i,this._writer=this._stream.writable.getWriter(),r.addEventListener("close",()=>{n.onClose({code:4,reason:"connection closed"})}),r.addEventListener("message",o=>{n.onMessage(o.data)}),this._startReading(r),n.onOpen()})}_startReading(e){return O(this,void 0,void 0,function*(){const n=this._stream.readable.getReader();let s="",r=0,i=new Uint8Array;try{for(;;){const{done:o,value:c}=yield n.read();if(c.length>0)if(this._protocol==="json")for(s+=this._utf8decoder.decode(c);r<s.length;)if(s[r]===`
`){const u=s.substring(0,r);e.dispatchEvent(new MessageEvent("message",{data:u})),s=s.substring(r+1),r=0}else++r;else{const u=new Uint8Array(i.length+c.length);for(u.set(i),u.set(c,i.length),i=u;;){const a=this.options.decoder.decodeReply(i);if(a.ok){const f=i.slice(0,a.pos);e.dispatchEvent(new MessageEvent("message",{data:f})),i=i.slice(a.pos);continue}break}}if(o)break}}catch{e.dispatchEvent(new Event("close"))}})}close(){return O(this,void 0,void 0,function*(){try{this._writer&&(yield this._writer.close()),this._transport.close()}catch{}})}send(e){return O(this,void 0,void 0,function*(){let n;this._protocol==="json"?n=new TextEncoder().encode(e+`
`):n=e;try{yield this._writer.write(n)}catch{this.close()}})}}const $s=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];class Ws{constructor(e){this.a=e,this.pos=0}haveBytes(){return this.pos<this.a.length}getByte(){const e=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw new RangeError("out of bounds");return e}getChar(){return String.fromCharCode(this.getByte())}getInt(){let e=0,n;for(;this.haveBytes()&&(n=$s[127&this.getByte()])>=0;)e=(e<<6)+n;return this.pos--,e>>>0}}class zs{constructor(){this.a=[]}toByteArray(e){return Array.isArray(e)?this.a:new Uint8Array(this.a)}putArray(e,n,s){for(let r=n;r<s;r++)this.a.push(e[r])}}function Hs(t){let e=0,n=0,s=0,r=0,i=0,o=t.length;for(;o>=16;)e=e+t[i+0]|0,n=n+t[i+1]|0,s=s+t[i+2]|0,r=r+t[i+3]|0,e=e+t[i+4]|0,n=n+t[i+5]|0,s=s+t[i+6]|0,r=r+t[i+7]|0,e=e+t[i+8]|0,n=n+t[i+9]|0,s=s+t[i+10]|0,r=r+t[i+11]|0,e=e+t[i+12]|0,n=n+t[i+13]|0,s=s+t[i+14]|0,r=r+t[i+15]|0,i+=16,o-=16;for(;o>=4;)e=e+t[i+0]|0,n=n+t[i+1]|0,s=s+t[i+2]|0,r=r+t[i+3]|0,i+=4,o-=4;switch(r=((r+(s<<8)|0)+(n<<16)|0)+(e<<24)|0,o){case 3:r=r+(t[i+2]<<8)|0;case 2:r=r+(t[i+1]<<16)|0;case 1:r=r+(t[i+0]<<24)|0}return r>>>0}function Fs(t,e){let n=0;const s=new Ws(e),r=t.length,i=e.length,o=s.getInt();if(s.getChar()!==`
`)throw new Error("size integer not terminated by '\\n'");const c=new zs;for(;s.haveBytes();){const u=s.getInt();let a;switch(s.getChar()){case"@":if(a=s.getInt(),s.haveBytes()&&s.getChar()!==",")throw new Error("copy command not terminated by ','");if(n+=u,n>o)throw new Error("copy exceeds output file size");if(a+u>r)throw new Error("copy extends past end of input");c.putArray(t,a,a+u);break;case":":if(n+=u,n>o)throw new Error("insert command gives an output larger than predicted");if(u>i)throw new Error("insert count exceeds size of delta");c.putArray(s.a,s.pos,s.pos+u),s.pos+=u;break;case";":{const f=c.toByteArray(t);if(u!==Hs(f))throw new Error("bad checksum");if(n!==o)throw new Error("generated size does not match predicted size");return f}default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")}class Rt{name(){return"json"}encodeCommands(e){return e.map(n=>JSON.stringify(n)).join(`
`)}decodeReplies(e){return e.trim().split(`
`).map(n=>JSON.parse(n))}applyDeltaIfNeeded(e,n){let s,r;if(e.delta){const i=Fs(n,new TextEncoder().encode(e.data));s=JSON.parse(new TextDecoder().decode(i)),r=i}else s=JSON.parse(e.data),r=new TextEncoder().encode(e.data);return{newData:s,newPrevValue:r}}}const qs={headers:{},token:"",getToken:null,data:null,getData:null,debug:!1,name:"js",version:"",fetch:null,readableStream:null,websocket:null,eventsource:null,sockjs:null,sockjsOptions:{},emulationEndpoint:"/emulation",minReconnectDelay:500,maxReconnectDelay:2e4,timeout:5e3,maxServerPingDelay:1e4,networkEventTarget:null};class A extends Error{constructor(e){super(e),this.name=this.constructor.name}}class Ce extends gn{constructor(e,n){super(),this._reconnectTimeout=null,this._refreshTimeout=null,this._serverPingTimeout=null,this.state=E.Disconnected,this._transportIsOpen=!1,this._endpoint=e,this._emulation=!1,this._transports=[],this._currentTransportIndex=0,this._triedAllTransports=!1,this._transportWasOpen=!1,this._transport=null,this._transportId=0,this._deviceWentOffline=!1,this._transportClosed=!0,this._codec=new Rt,this._reconnecting=!1,this._reconnectTimeout=null,this._reconnectAttempts=0,this._client=null,this._session="",this._node="",this._subs={},this._serverSubs={},this._commandId=0,this._commands=[],this._batching=!1,this._refreshRequired=!1,this._refreshTimeout=null,this._callbacks={},this._token="",this._data=null,this._dispatchPromise=Promise.resolve(),this._serverPing=0,this._serverPingTimeout=null,this._sendPong=!1,this._promises={},this._promiseId=0,this._debugEnabled=!1,this._networkEventsSet=!1,this._config=Object.assign(Object.assign({},qs),n),this._configure(),this._debugEnabled?(this.on("state",s=>{this._debug("client state",s.oldState,"->",s.newState)}),this.on("error",s=>{this._debug("client error",s)})):this.on("error",function(){Function.prototype()})}newSubscription(e,n){if(this.getSubscription(e)!==null)throw new Error("Subscription to the channel "+e+" already exists");const s=new Us(this,e,n);return this._subs[e]=s,s}getSubscription(e){return this._getSub(e)}removeSubscription(e){e&&(e.state!==C.Unsubscribed&&e.unsubscribe(),this._removeSubscription(e))}subscriptions(){return this._subs}ready(e){switch(this.state){case E.Disconnected:return Promise.reject({code:S.clientDisconnected,message:"client disconnected"});case E.Connected:return Promise.resolve();default:return new Promise((n,s)=>{const r={resolve:n,reject:s};e&&(r.timeout=setTimeout(()=>{s({code:S.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=r})}}connect(){if(this._isConnected()){this._debug("connect called when already connected");return}if(this._isConnecting()){this._debug("connect called when already connecting");return}this._debug("connect called"),this._reconnectAttempts=0,this._startConnecting()}disconnect(){this._disconnect(ee.disconnectCalled,"disconnect called",!1)}setToken(e){this._token=e}setHeaders(e){this._config.headers=e}send(e){return O(this,void 0,void 0,function*(){const n={send:{data:e}};if(yield this._methodCall(),!this._transportSendCommands([n]))throw this._createErrorObject(S.transportWriteError,"transport write error")})}rpc(e,n){return O(this,void 0,void 0,function*(){const s={rpc:{method:e,data:n}};return yield this._methodCall(),{data:(yield this._callPromise(s,i=>i.rpc)).data}})}publish(e,n){return O(this,void 0,void 0,function*(){const s={publish:{channel:e,data:n}};return yield this._methodCall(),yield this._callPromise(s,()=>({})),{}})}history(e,n){return O(this,void 0,void 0,function*(){const s={history:this._getHistoryRequest(e,n)};yield this._methodCall();const r=yield this._callPromise(s,o=>o.history),i=[];if(r.publications)for(let o=0;o<r.publications.length;o++)i.push(this._getPublicationContext(e,r.publications[o]));return{publications:i,epoch:r.epoch||"",offset:r.offset||0}})}presence(e){return O(this,void 0,void 0,function*(){const n={presence:{channel:e}};yield this._methodCall();const r=(yield this._callPromise(n,i=>i.presence)).presence;for(const i in r)if(Object.prototype.hasOwnProperty.call(r,i)){const o=r[i],c=o.conn_info,u=o.chan_info;c&&(o.connInfo=c),u&&(o.chanInfo=u)}return{clients:r}})}presenceStats(e){return O(this,void 0,void 0,function*(){const n={presence_stats:{channel:e}};yield this._methodCall();const s=yield this._callPromise(n,r=>r.presence_stats);return{numUsers:s.num_users,numClients:s.num_clients}})}startBatching(){this._batching=!0}stopBatching(){const e=this;Promise.resolve().then(function(){Promise.resolve().then(function(){e._batching=!1,e._flush()})})}_debug(...e){this._debugEnabled&&xs("debug",e)}_codecName(){return this._codec.name()}_formatOverride(){}_configure(){if(!("Promise"in globalThis))throw new Error("Promise polyfill required");if(!this._endpoint)throw new Error("endpoint configuration required");if(this._config.token!==null&&(this._token=this._config.token),this._config.data!==null&&(this._data=this._config.data),this._codec=new Rt,this._formatOverride(),(this._config.debug===!0||typeof localStorage<"u"&&localStorage.getItem("centrifuge.debug"))&&(this._debugEnabled=!0),this._debug("config",this._config),typeof this._endpoint!="string")if(typeof this._endpoint=="object"&&this._endpoint instanceof Array){this._transports=this._endpoint,this._emulation=!0;for(const e in this._transports)if(this._transports.hasOwnProperty(e)){const n=this._transports[e];if(!n.endpoint||!n.transport)throw new Error("malformed transport configuration");const s=n.transport;if(["websocket","http_stream","sse","sockjs","webtransport"].indexOf(s)<0)throw new Error("unsupported transport name: "+s)}}else throw new Error("unsupported url configuration type: only string or array of objects are supported")}_setState(e){if(this.state!==e){this._reconnecting=!1;const n=this.state;return this.state=e,this.emit("state",{newState:e,oldState:n}),!0}return!1}_isDisconnected(){return this.state===E.Disconnected}_isConnecting(){return this.state===E.Connecting}_isConnected(){return this.state===E.Connected}_nextCommandId(){return++this._commandId}_setNetworkEvents(){if(this._networkEventsSet)return;let e=null;this._config.networkEventTarget!==null?e=this._config.networkEventTarget:typeof globalThis.addEventListener<"u"&&(e=globalThis),e&&(e.addEventListener("offline",()=>{this._debug("offline event triggered"),(this.state===E.Connected||this.state===E.Connecting)&&(this._disconnect(z.transportClosed,"transport closed",!0),this._deviceWentOffline=!0)}),e.addEventListener("online",()=>{this._debug("online event triggered"),this.state===E.Connecting&&(this._deviceWentOffline&&!this._transportClosed&&(this._deviceWentOffline=!1,this._transportClosed=!0),this._clearReconnectTimeout(),this._startReconnecting())}),this._networkEventsSet=!0)}_getReconnectDelay(){const e=ge(this._reconnectAttempts,this._config.minReconnectDelay,this._config.maxReconnectDelay);return this._reconnectAttempts+=1,e}_clearOutgoingRequests(){for(const e in this._callbacks)if(this._callbacks.hasOwnProperty(e)){const n=this._callbacks[e];clearTimeout(n.timeout);const s=n.errback;if(!s)continue;s({error:this._createErrorObject(S.connectionClosed,"connection closed")})}this._callbacks={}}_clearConnectedState(){this._client=null,this._clearServerPingTimeout(),this._clearRefreshTimeout();for(const e in this._subs){if(!this._subs.hasOwnProperty(e))continue;const n=this._subs[e];n.state===C.Subscribed&&n._setSubscribing(me.transportClosed,"transport closed")}for(const e in this._serverSubs)this._serverSubs.hasOwnProperty(e)&&this.emit("subscribing",{channel:e})}_handleWriteError(e){for(const n of e){const s=n.id;if(!(s in this._callbacks))continue;const r=this._callbacks[s];clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s];const i=r.errback;i({error:this._createErrorObject(S.transportWriteError,"transport write error")})}}_transportSendCommands(e){if(!e.length)return!0;if(!this._transport)return!1;try{this._transport.send(this._codec.encodeCommands(e),this._session,this._node)}catch(n){return this._debug("error writing commands",n),this._handleWriteError(e),!1}return!0}_initializeTransport(){let e;this._config.websocket!==null?e=this._config.websocket:typeof globalThis.WebSocket!="function"&&typeof globalThis.WebSocket!="object"||(e=globalThis.WebSocket);let n=null;this._config.sockjs!==null?n=this._config.sockjs:typeof globalThis.SockJS<"u"&&(n=globalThis.SockJS);let s=null;this._config.eventsource!==null?s=this._config.eventsource:typeof globalThis.EventSource<"u"&&(s=globalThis.EventSource);let r=null;this._config.fetch!==null?r=this._config.fetch:typeof globalThis.fetch<"u"&&(r=globalThis.fetch);let i=null;if(this._config.readableStream!==null?i=this._config.readableStream:typeof globalThis.ReadableStream<"u"&&(i=globalThis.ReadableStream),this._emulation){this._currentTransportIndex>=this._transports.length&&(this._triedAllTransports=!0,this._currentTransportIndex=0);let l=0;for(;;){if(l>=this._transports.length)throw new Error("no supported transport found");const h=this._transports[this._currentTransportIndex],m=h.transport,p=h.endpoint;if(m==="websocket"){if(this._debug("trying websocket transport"),this._transport=new Pt(p,{websocket:e}),!this._transport.supported()){this._debug("websocket transport not available"),this._currentTransportIndex++,l++;continue}}else if(m==="webtransport"){if(this._debug("trying webtransport transport"),this._transport=new Ms(p,{webtransport:globalThis.WebTransport,decoder:this._codec,encoder:this._codec}),!this._transport.supported()){this._debug("webtransport transport not available"),this._currentTransportIndex++,l++;continue}}else if(m==="http_stream"){if(this._debug("trying http_stream transport"),this._transport=new As(p,{fetch:r,readableStream:i,emulationEndpoint:this._config.emulationEndpoint,decoder:this._codec,encoder:this._codec}),!this._transport.supported()){this._debug("http_stream transport not available"),this._currentTransportIndex++,l++;continue}}else if(m==="sse"){if(this._debug("trying sse transport"),this._transport=new js(p,{eventsource:s,fetch:r,emulationEndpoint:this._config.emulationEndpoint}),!this._transport.supported()){this._debug("sse transport not available"),this._currentTransportIndex++,l++;continue}}else if(m==="sockjs"){if(this._debug("trying sockjs"),this._transport=new Ns(p,{sockjs:n,sockjsOptions:this._config.sockjsOptions}),!this._transport.supported()){this._debug("sockjs transport not available"),this._currentTransportIndex++,l++;continue}}else throw new Error("unknown transport "+m);break}}else{if(Is(this._endpoint,"http"))throw new Error("Provide explicit transport endpoints configuration in case of using HTTP (i.e. using array of TransportEndpoint instead of a single string), or use ws(s):// scheme in an endpoint if you aimed using WebSocket transport");if(this._debug("client will use websocket"),this._transport=new Pt(this._endpoint,{websocket:e}),!this._transport.supported())throw new Error("WebSocket constructor not found, make sure it is available globally or passed as a dependency in Centrifuge options")}const o=this,c=this._transport,u=this._nextTransportId();o._debug("id of transport",u);let a=!1;const f=[];if(this._transport.emulation()){const l=o._sendConnect(!0);f.push(l)}this._setNetworkEvents();const _=this._codec.encodeCommands(f);this._transportClosed=!1;let d;d=setTimeout(function(){c.close()},this._config.timeout),this._transport.initialize(this._codecName(),{onOpen:function(){if(d&&(clearTimeout(d),d=null),o._transportId!=u){o._debug("open callback from non-actual transport"),c.close();return}a=!0,o._debug(c.subName(),"transport open"),!c.emulation()&&(o._transportIsOpen=!0,o._transportWasOpen=!0,o.startBatching(),o._sendConnect(!1),o._sendSubscribeCommands(),o.stopBatching(),o.emit("__centrifuge_debug:connect_frame_sent",{}))},onError:function(l){if(o._transportId!=u){o._debug("error callback from non-actual transport");return}o._debug("transport level error",l)},onClose:function(l){if(d&&(clearTimeout(d),d=null),o._transportId!=u){o._debug("close callback from non-actual transport");return}o._debug(c.subName(),"transport closed"),o._transportClosed=!0,o._transportIsOpen=!1;let h="connection closed",m=!0,p=0;if(l&&"code"in l&&l.code&&(p=l.code),l&&l.reason)try{const g=JSON.parse(l.reason);h=g.reason,m=g.reconnect}catch{h=l.reason,(p>=3500&&p<4e3||p>=4500&&p<5e3)&&(m=!1)}p<3e3?(p===1009?(p=ee.messageSizeLimit,h="message size limit exceeded",m=!1):(p=z.transportClosed,h="transport closed"),o._emulation&&!o._transportWasOpen&&(o._currentTransportIndex++,o._currentTransportIndex>=o._transports.length&&(o._triedAllTransports=!0,o._currentTransportIndex=0))):o._transportWasOpen=!0,o._isConnecting()&&!a&&o.emit("error",{type:"transport",error:{code:S.transportClosed,message:"transport closed"},transport:c.name()}),o._reconnecting=!1,o._disconnect(p,h,m)},onMessage:function(l){o._dataReceived(l)}},_),o.emit("__centrifuge_debug:transport_initialized",{})}_sendConnect(e){const n=this._constructConnectCommand(),s=this;return this._call(n,e).then(r=>{const i=r.reply.connect;s._connectResponse(i),r.next&&r.next()},r=>{s._connectError(r.error),r.next&&r.next()}),n}_startReconnecting(){if(this._debug("start reconnecting"),!this._isConnecting()){this._debug("stop reconnecting: client not in connecting state");return}if(this._reconnecting){this._debug("reconnect already in progress, return from reconnect routine");return}if(this._transportClosed===!1){this._debug("waiting for transport close");return}this._reconnecting=!0;const e=this._token==="";if(!(this._refreshRequired||e&&this._config.getToken!==null)){this._config.getData?this._config.getData().then(r=>{this._isConnecting()&&(this._data=r,this._initializeTransport())}).catch(r=>this._handleGetDataError(r)):this._initializeTransport();return}const s=this;this._getToken().then(function(r){if(s._isConnecting()){if(r==null||r==null){s._failUnauthorized();return}s._token=r,s._debug("connection token refreshed"),s._config.getData?s._config.getData().then(function(i){s._isConnecting()&&(s._data=i,s._initializeTransport())}).catch(i=>s._handleGetDataError(i)):s._initializeTransport()}}).catch(function(r){if(!s._isConnecting())return;if(r instanceof A){s._failUnauthorized();return}s.emit("error",{type:"connectToken",error:{code:S.clientConnectToken,message:r!==void 0?r.toString():""}});const i=s._getReconnectDelay();s._debug("error on getting connection token, reconnect after "+i+" milliseconds",r),s._reconnecting=!1,s._reconnectTimeout=setTimeout(()=>{s._startReconnecting()},i)})}_handleGetDataError(e){if(e instanceof A){this._failUnauthorized();return}this.emit("error",{type:"connectData",error:{code:S.badConfiguration,message:e?.toString()||""}});const n=this._getReconnectDelay();this._debug("error on getting connect data, reconnect after "+n+" milliseconds",e),this._reconnecting=!1,this._reconnectTimeout=setTimeout(()=>{this._startReconnecting()},n)}_connectError(e){this.state===E.Connecting&&(e.code===109&&(this._refreshRequired=!0),e.code<100||e.temporary===!0||e.code===109?(this.emit("error",{type:"connect",error:e}),this._debug("closing transport due to connect error"),this._disconnect(e.code,e.message,!0)):this._disconnect(e.code,e.message,!1))}_scheduleReconnect(){if(!this._isConnecting())return;let e=!1;this._emulation&&!this._transportWasOpen&&!this._triedAllTransports&&(e=!0);let n=this._getReconnectDelay();e&&(n=0),this._debug("reconnect after "+n+" milliseconds"),this._clearReconnectTimeout(),this._reconnectTimeout=setTimeout(()=>{this._startReconnecting()},n)}_constructConnectCommand(){const e={};this._token&&(e.token=this._token),this._data&&(e.data=this._data),this._config.name&&(e.name=this._config.name),this._config.version&&(e.version=this._config.version),Object.keys(this._config.headers).length>0&&(e.headers=this._config.headers);const n={};let s=!1;for(const r in this._serverSubs)if(this._serverSubs.hasOwnProperty(r)&&this._serverSubs[r].recoverable){s=!0;const i={recover:!0};this._serverSubs[r].offset&&(i.offset=this._serverSubs[r].offset),this._serverSubs[r].epoch&&(i.epoch=this._serverSubs[r].epoch),n[r]=i}return s&&(e.subs=n),{connect:e}}_getHistoryRequest(e,n){const s={channel:e};return n!==void 0&&(n.since&&(s.since={offset:n.since.offset},n.since.epoch&&(s.since.epoch=n.since.epoch)),n.limit!==void 0&&(s.limit=n.limit),n.reverse===!0&&(s.reverse=!0)),s}_methodCall(){return this._isConnected()?Promise.resolve():new Promise((e,n)=>{const s=setTimeout(function(){n({code:S.timeout,message:"timeout"})},this._config.timeout);this._promises[this._nextPromiseId()]={timeout:s,resolve:e,reject:n}})}_callPromise(e,n){return new Promise((s,r)=>{this._call(e,!1).then(i=>{var o;const c=n(i.reply);s(c),(o=i.next)===null||o===void 0||o.call(i)},i=>{var o;r(i.error),(o=i.next)===null||o===void 0||o.call(i)})})}_dataReceived(e){this._serverPing>0&&this._waitServerPing();const n=this._codec.decodeReplies(e);this._dispatchPromise=this._dispatchPromise.then(()=>{let s;this._dispatchPromise=new Promise(r=>{s=r}),this._dispatchSynchronized(n,s)})}_dispatchSynchronized(e,n){let s=Promise.resolve();for(const r in e)e.hasOwnProperty(r)&&(s=s.then(()=>this._dispatchReply(e[r])));s=s.then(()=>{n()})}_dispatchReply(e){let n;const s=new Promise(i=>{n=i});if(e==null)return this._debug("dispatch: got undefined or null reply"),n(),s;const r=e.id;return r&&r>0?this._handleReply(e,n):e.push?this._handlePush(e.push,n):this._handleServerPing(n),s}_call(e,n){return new Promise((s,r)=>{e.id=this._nextCommandId(),this._registerCall(e.id,s,r),n||this._addCommand(e)})}_startConnecting(){this._debug("start connecting"),this._setState(E.Connecting)&&this.emit("connecting",{code:z.connectCalled,reason:"connect called"}),this._client=null,this._startReconnecting()}_disconnect(e,n,s){if(this._isDisconnected())return;this._transportIsOpen=!1;const r=this.state;this._reconnecting=!1;const i={code:e,reason:n};let o=!1;if(s?o=this._setState(E.Connecting):(o=this._setState(E.Disconnected),this._rejectPromises({code:S.clientDisconnected,message:"disconnected"})),this._clearOutgoingRequests(),r===E.Connecting&&this._clearReconnectTimeout(),r===E.Connected&&this._clearConnectedState(),o&&(this._isConnecting()?this.emit("connecting",i):this.emit("disconnected",i)),this._transport){this._debug("closing existing transport");const c=this._transport;this._transport=null,c.close(),this._transportClosed=!0,this._nextTransportId()}else this._debug("no transport to close");this._scheduleReconnect()}_failUnauthorized(){this._disconnect(ee.unauthorized,"unauthorized",!1)}_getToken(){return this._debug("get connection token"),this._config.getToken?this._config.getToken({}):(this.emit("error",{type:"configuration",error:{code:S.badConfiguration,message:"token expired but no getToken function set in the configuration"}}),Promise.reject(new A("")))}_refresh(){const e=this._client,n=this;this._getToken().then(function(s){if(e!==n._client)return;if(!s){n._failUnauthorized();return}if(n._token=s,n._debug("connection token refreshed"),!n._isConnected())return;const r={refresh:{token:n._token}};n._call(r,!1).then(i=>{const o=i.reply.refresh;n._refreshResponse(o),i.next&&i.next()},i=>{n._refreshError(i.error),i.next&&i.next()})}).catch(function(s){if(n._isConnected()){if(s instanceof A){n._failUnauthorized();return}n.emit("error",{type:"refreshToken",error:{code:S.clientRefreshToken,message:s!==void 0?s.toString():""}}),n._refreshTimeout=setTimeout(()=>n._refresh(),n._getRefreshRetryDelay())}})}_refreshError(e){e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._disconnect(e.code,e.message,!1)}_getRefreshRetryDelay(){return ge(0,5e3,1e4)}_refreshResponse(e){this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),e.expires&&(this._client=e.client,this._refreshTimeout=setTimeout(()=>this._refresh(),ve(e.ttl)))}_removeSubscription(e){e!==null&&delete this._subs[e.channel]}_unsubscribe(e){if(!this._transportIsOpen)return Promise.resolve();const s={unsubscribe:{channel:e.channel}},r=this;return new Promise((o,c)=>{this._call(s,!1).then(u=>{o(),u.next&&u.next()},u=>{o(),u.next&&u.next(),r._disconnect(z.unsubscribeError,"unsubscribe error",!0)})})}_getSub(e){const n=this._subs[e];return n||null}_isServerSub(e){return this._serverSubs[e]!==void 0}_sendSubscribeCommands(){const e=[];for(const n in this._subs){if(!this._subs.hasOwnProperty(n))continue;const s=this._subs[n];if(s._inflight!==!0&&s.state===C.Subscribing){const r=s._subscribe();r&&e.push(r)}}return e}_connectResponse(e){if(this._transportIsOpen=!0,this._transportWasOpen=!0,this._reconnectAttempts=0,this._refreshRequired=!1,this._isConnected())return;this._client=e.client,this._setState(E.Connected),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout(()=>this._refresh(),ve(e.ttl))),this._session=e.session,this._node=e.node,this.startBatching(),this._sendSubscribeCommands(),this.stopBatching();const n={client:e.client,transport:this._transport.subName()};e.data&&(n.data=e.data),this.emit("connected",n),this._resolvePromises(),this._processServerSubs(e.subs||{}),e.ping&&e.ping>0?(this._serverPing=e.ping*1e3,this._sendPong=e.pong===!0,this._waitServerPing()):this._serverPing=0}_processServerSubs(e){for(const n in e){if(!e.hasOwnProperty(n))continue;const s=e[n];this._serverSubs[n]={offset:s.offset,epoch:s.epoch,recoverable:s.recoverable||!1};const r=this._getSubscribeContext(n,s);this.emit("subscribed",r)}for(const n in e){if(!e.hasOwnProperty(n))continue;const s=e[n];if(s.recovered){const r=s.publications;if(r&&r.length>0)for(const i in r)r.hasOwnProperty(i)&&this._handlePublication(n,r[i])}}for(const n in this._serverSubs)this._serverSubs.hasOwnProperty(n)&&(e[n]||(this.emit("unsubscribed",{channel:n}),delete this._serverSubs[n]))}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearReconnectTimeout(){this._reconnectTimeout!==null&&(clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null)}_clearServerPingTimeout(){this._serverPingTimeout!==null&&(clearTimeout(this._serverPingTimeout),this._serverPingTimeout=null)}_waitServerPing(){this._config.maxServerPingDelay!==0&&this._isConnected()&&(this._clearServerPingTimeout(),this._serverPingTimeout=setTimeout(()=>{this._isConnected()&&this._disconnect(z.noPing,"no ping",!0)},this._serverPing+this._config.maxServerPingDelay))}_getSubscribeContext(e,n){const s={channel:e,positioned:!1,recoverable:!1,wasRecovering:!1,recovered:!1,hasRecoveredPublications:!1};n.recovered&&(s.recovered=!0),n.positioned&&(s.positioned=!0),n.recoverable&&(s.recoverable=!0),n.was_recovering&&(s.wasRecovering=!0);let r="";"epoch"in n&&(r=n.epoch);let i=0;return"offset"in n&&(i=n.offset),(s.positioned||s.recoverable)&&(s.streamPosition={offset:i,epoch:r}),Array.isArray(n.publications)&&n.publications.length>0&&(s.hasRecoveredPublications=!0),n.data&&(s.data=n.data),s}_handleReply(e,n){const s=e.id;if(!(s in this._callbacks)){n();return}const r=this._callbacks[s];if(clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s],Ds(e)){const i=r.errback;if(!i){n();return}const o={code:e.error.code,message:e.error.message||"",temporary:e.error.temporary||!1};i({error:o,next:n})}else{const i=r.callback;if(!i)return;i({reply:e,next:n})}}_handleJoin(e,n){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const r={channel:e,info:this._getJoinLeaveContext(n.info)};this.emit("join",r)}return}s._handleJoin(n)}_handleLeave(e,n){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const r={channel:e,info:this._getJoinLeaveContext(n.info)};this.emit("leave",r)}return}s._handleLeave(n)}_handleUnsubscribe(e,n){const s=this._getSub(e);if(!s){this._isServerSub(e)&&(delete this._serverSubs[e],this.emit("unsubscribed",{channel:e}));return}n.code<2500?s._setUnsubscribed(n.code,n.reason,!1):s._setSubscribing(n.code,n.reason)}_handleSubscribe(e,n){this._serverSubs[e]={offset:n.offset,epoch:n.epoch,recoverable:n.recoverable||!1},this.emit("subscribed",this._getSubscribeContext(e,n))}_handleDisconnect(e){const n=e.code;let s=!0;(n>=3500&&n<4e3||n>=4500&&n<5e3)&&(s=!1),this._disconnect(n,e.reason,s)}_getPublicationContext(e,n){const s={channel:e,data:n.data};return n.offset&&(s.offset=n.offset),n.info&&(s.info=this._getJoinLeaveContext(n.info)),n.tags&&(s.tags=n.tags),s}_getJoinLeaveContext(e){const n={client:e.client,user:e.user},s=e.conn_info;s&&(n.connInfo=s);const r=e.chan_info;return r&&(n.chanInfo=r),n}_handlePublication(e,n){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const r=this._getPublicationContext(e,n);this.emit("publication",r),n.offset!==void 0&&(this._serverSubs[e].offset=n.offset)}return}s._handlePublication(n)}_handleMessage(e){this.emit("message",{data:e.data})}_handleServerPing(e){if(this._sendPong){const n={};this._transportSendCommands([n])}e()}_handlePush(e,n){const s=e.channel;e.pub?this._handlePublication(s,e.pub):e.message?this._handleMessage(e.message):e.join?this._handleJoin(s,e.join):e.leave?this._handleLeave(s,e.leave):e.unsubscribe?this._handleUnsubscribe(s,e.unsubscribe):e.subscribe?this._handleSubscribe(s,e.subscribe):e.disconnect&&this._handleDisconnect(e.disconnect),n()}_flush(){const e=this._commands.slice(0);this._commands=[],this._transportSendCommands(e)}_createErrorObject(e,n,s){const r={code:e,message:n};return s&&(r.temporary=!0),r}_registerCall(e,n,s){this._callbacks[e]={callback:n,errback:s,timeout:null},this._callbacks[e].timeout=setTimeout(()=>{delete this._callbacks[e],vn(s)&&s({error:this._createErrorObject(S.timeout,"timeout")})},this._config.timeout)}_addCommand(e){this._batching?this._commands.push(e):this._transportSendCommands([e])}_nextPromiseId(){return++this._promiseId}_nextTransportId(){return++this._transportId}_resolvePromises(){for(const e in this._promises)this._promises.hasOwnProperty(e)&&(this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e])}_rejectPromises(e){for(const n in this._promises)this._promises.hasOwnProperty(n)&&(this._promises[n].timeout&&clearTimeout(this._promises[n].timeout),this._promises[n].reject(e),delete this._promises[n])}}Ce.SubscriptionState=C;Ce.State=E;Ce.UnauthorizedError=A;function Bs(t,e){const n=k.socket=new Ce(t);n.setToken(e),n.on("connected",s=>{H("connected",{ctx:s}),k.connected=!0,k.taskQueue.forEach(r=>r()),k.taskQueue=[],k.socketId=s.client}),n.on("disconnected",s=>{H("disconnected",{ctx:s}),k.connected=!1}),n.on("error",s=>{H("error",{ctx:s}),k.connected=!1}),n.connect()}function yn(t,e){return t.key+"_"+e.eventName}function Js(t,e){const n=k.listeners.get(t.key);if(!n)return;const s=e.data,r=n.get(yn(t,s));r&&r.forEach(i=>{try{i(e.data.payload)}catch{console.error("handleIncomingMessage",t,e)}})}function Xe(t){return new Promise((e,n)=>{let s=k.socket.getSubscription(t.key);s?.state===C.Subscribed&&e({subscription:s});const r=()=>{s=k.socket.getSubscription(t.key),s?.state!==C.Subscribed&&(s?(s.subscribe(),e({subscription:s})):(s=k.socket.newSubscription(t.key),H("%c subscribed on "+t.key,"color: #0f0"),s.on("publication",i=>{Js(t,i)}),s.on("subscribed",()=>{e({subscription:s})}),s.subscribe()))};k.connected?r():k.taskQueue.push(r)})}function Vs(t){return k.listeners.get(t.key)||k.emitters.get(t.key)}function Gs(t){if(Vs(t))return;const e=k.socket;H("leaving channel "+t.key);const n=e.getSubscription(t.key);n&&(n.unsubscribe(),H("%c unsubscribed from "+t.key,"color: #f00"))}function Qs(){return Math.random().toString(36).substring(2)}function Zs(t,e,n){Xe(t),k.listeners.has(t.key)||k.listeners.set(t.key,new Map);const s=k.listeners.get(t.key),r=yn(t,e);s.has(r)||s.set(r,new Map);const i=s.get(r),o=r+"--"+Qs();return i.set(o,n),H("adding listener",r),()=>{i.delete(o),i.size===0&&s.delete(r),s.size===0&&k.listeners.delete(t.key),H("removing listener",r),Gs(t)}}function Xs(t,e){return typeof t.transform=="function"?t.transform(t.eventName,e):{eventName:t.eventName,payload:e}}async function Ys(t,e,n){try{const s=(await Xe(t)).subscription,r=Xs(e,n);await s.publish(r),console.log("event published",e.eventName)}catch(s){console.error(t,e,n,s)}}let de={ICE_CANDIDATE:new Ie,OFFER:new Ie,ANSWER:new Ie};Ss(de);function Ks(t,e){const n=[],s={key:"conf_"+e};return{off:()=>n.forEach(r=>r()),offer:xe(s,de.OFFER,n),answer:xe(s,de.ANSWER,n),iceCandidate:xe(s,de.ICE_CANDIDATE,n),setUserIdList:null,async connect(){const r=async()=>await this.setUserIdList(Object.keys((await i.presence()).clients)),{subscription:i}=await Xe(s);i.on("join",async()=>await r()),i.on("leave",async()=>await r()),await r()}}}function xe(t,e,n){return{async emit(s){await Ys(t,e,s)},on(s){n.push(Zs(t,e,s))}}}async function er(){const t="https://chessclub.spb.ru/rest/auth.rest.jwt",{session:e}=await tr(new XMLHttpRequest,t,"userId","test-client"),n="wss://chessclub.spb.ru/centrifugo/connection/websocket";return new Promise(s=>{Bs(n,e),k.log=!0,k.socket.on("connected",()=>{s(k.socketId)})})}async function tr(t,e,n,s){return new Promise((r,i)=>{t.open("POST",e),t.onload=()=>r(JSON.parse(t.response||t.responseText)),t.onerror=i,t.send(JSON.stringify({user_id:n,name:s}))})}const Le=Te({prefix:"[AppStore]",color:"#ddd"}),Sn=un((t,e)=>{const n=ys();return n.onChange=async s=>{Le("users changed",s),t({otherUsers:[...e().otherUsers]})},n.onJoin=async s=>{Le("users joined",s),t({otherUsers:[...e().otherUsers,...s]})},n.onLeft=async s=>{Le("users left",s);const r=[...e().otherUsers];s.forEach(i=>{const o=r.find(c=>c.userId===i.userId);r.splice(r.indexOf(o),1)}),t({otherUsers:r})},{otherUsers:[],async updateTracks(){const s=ke.getState().getActualTracks();n.updateTracks(s)},async enter(s,r){const i=Ks(s,r);await n.connect(s,i)}}});function nr(){const{updateTracks:t,otherUsers:e}=Sn(),n=ke();async function s(){await(n.cameraStreamTrack?n.stopCameraStream:n.startCameraStream)(),await t()}async function r(){await(n.microphoneStreamTrack?n.stopMicrophoneStream:n.startMicrophoneStream)(),await t()}async function i(){await(n.desktopStreamTrack?n.stopDesktopStream:n.startDesktopStream)(),await t()}return R("div",{children:[R("button",{onClick:s,children:n.cameraStreamTrack?"disable cam":"enable cam"}),R("button",{onClick:r,children:n.microphoneStreamTrack?"disable mic":"enable mic"}),R("button",{onClick:i,children:(n.desktopStreamTrack,"share screen")}),R("div",{children:[R(Ot,{tracks:n.getActualTracks(!0),connection:"self"}),e.map(o=>R(Ot,{tracks:o.tracks,connection:o.status},o.userId))]})]})}const Ot=oe(({tracks:t,connection:e})=>R("div",{style:{border:"1px solid black",width:300,minHeight:200},children:[R("div",{children:["tracks: ",t.length," connection: ",e]}),t.map(n=>R(sr,{track:n},n.id))]})),sr=oe(({track:t})=>t.kind==="audio"?R(rr,{track:t}):R(ir,{track:t})),rr=oe(({track:t})=>{const e=Ve(null);return ye(()=>{(async function(){try{await e.current.play()}catch{}try{await e.current.play()}catch{}})()},[t]),R("audio",{ref:e,autoplay:!0,playsInline:!0,srcObject:new MediaStream([t])})}),ir=oe(({track:t})=>R("video",{width:300,muted:!0,autoPlay:!0,playsinline:!0,playsInline:!0,srcObject:new MediaStream([t])}));function or(t){return{render:function(e){cn(e,t)},unmount:function(){an(t)}}}function cr(t=""){const e=s=>t+"_"+s,n=e("quality");return{setEnabled(s,r){r?localStorage.setItem(e(s),"true"):localStorage.removeItem(e(s))},isEnabled(s){return!!localStorage.getItem(e(s))},setQuality(s){localStorage.setItem(n,s)},getQuality(){const s=localStorage.getItem(n);return s?x[s]:x.LOW}}}(async()=>{await ke.getState().restore(cr()),or(document.getElementById("root")).render(R(nr,{}));const t=await er();Sn.getState().enter(t,"deadbeefx")})();
